<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hellomagento2/images/cropped-favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hellomagento2/images/cropped-favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hellomagento2/images/cropped-favicon-16x16.png">
  <link rel="mask-icon" href="/hellomagento2/images/cropped-favicon.svg" color="#222">

<link rel="stylesheet" href="/hellomagento2/css/main.css">


<link rel="stylesheet" href="/hellomagento2/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"piscesthankit.github.io","root":"/hellomagento2/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="{ Hello Magento 2 }">
<meta property="og:url" content="https://piscesthankit.github.io/hellomagento2/page/5/index.html">
<meta property="og:site_name" content="{ Hello Magento 2 }">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ThankIT">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://piscesthankit.github.io/hellomagento2/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>{ Hello Magento 2 }</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/hellomagento2/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">{ Hello Magento 2 }</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">解决 Magento 2 应用问题，更注重深度挖掘。(ง •̀_•́)ง</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/hellomagento2/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/hellomagento2/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hellomagento2/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hellomagento2/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/create-customer-attribute/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/create-customer-attribute/" class="post-title-link" itemprop="url">create customer attribute</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-04 18:26:48" itemprop="dateCreated datePublished" datetime="2019-06-04T18:26:48+08:00">2019-06-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#notes"></a>Notes</h2><p>Custom attributes are those added on behalf of a merchant. For example, a merchant might need to add attributes to describe products, such as shape or volume. A merchant can add these attributes in the Magento Admin panel. Custom attributes are a subset of EAV attributes.</p>
<h2 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a><a href="#experiments"></a>Experiments</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Setup\Patch\Data;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Setup\Patch\DataPatchInterface;</span><br><span class="line">use Magento\Customer\Model\Customer;</span><br><span class="line">use Magento\Customer\Setup\CustomerSetupFactory;</span><br><span class="line">use Magento\Eav\Setup\EavSetupFactory;</span><br><span class="line">use Magento\Framework\Setup\ModuleDataSetupInterface;</span><br><span class="line">use Magento\Eav\Model\Entity\Attribute\SetFactory as AttributeSetFactory;</span><br><span class="line"></span><br><span class="line">class TestPatch implements DataPatchInterface</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct(</span><br><span class="line">        ModuleDataSetupInterface $moduleDataSetup,</span><br><span class="line">        CustomerSetupFactory $customerSetupFactory,</span><br><span class="line">        EavSetupFactory $eavSetupFactory,</span><br><span class="line">        AttributeSetFactory $attributeSetFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;moduleDataSetup = $moduleDataSetup;</span><br><span class="line">        $this-&gt;customerSetupFactory = $customerSetupFactory;</span><br><span class="line">        $this-&gt;eavSetupFactory = $eavSetupFactory;</span><br><span class="line">        $this-&gt;attributeSetFactory = $attributeSetFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getAliases()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         * This internal Magento method, that means that some patches with time can change their names,</span><br><span class="line">         * but changing name should not affect installation process, that&#x27;s why if we will change name of the patch</span><br><span class="line">         * we will add alias here</span><br><span class="line">         */</span><br><span class="line">        return [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function apply()</span><br><span class="line">    &#123;</span><br><span class="line">        $customerSetup = $this-&gt;customerSetupFactory-&gt;create([&#x27;setup&#x27; =&gt; $this-&gt;moduleDataSetup]);</span><br><span class="line"></span><br><span class="line">        $customerSetup-&gt;addAttribute(</span><br><span class="line">            Customer::ENTITY,</span><br><span class="line">            &#x27;c_telephone&#x27;,</span><br><span class="line">            [</span><br><span class="line">                &#x27;type&#x27; =&gt; &#x27;varchar&#x27;,</span><br><span class="line">                &#x27;label&#x27; =&gt; &#x27;Custom telephone&#x27;,</span><br><span class="line">                &#x27;input&#x27; =&gt; &#x27;text&#x27;,</span><br><span class="line">                &#x27;required&#x27; =&gt; false,</span><br><span class="line">                &#x27;position&#x27; =&gt; 250,</span><br><span class="line">                &#x27;visible&#x27; =&gt; true,</span><br><span class="line">                &#x27;user_defined&#x27; =&gt; 1,</span><br><span class="line">                &#x27;group&#x27; =&gt; &#x27;General&#x27;,</span><br><span class="line">                &#x27;system&#x27; =&gt; false,</span><br><span class="line">                &#x27;validate_rules&#x27; =&gt; &#x27;&#123;&quot;max_text_length&quot;:255,&quot;min_text_length&quot;:1&#125;&#x27;,</span><br><span class="line">                &#x27;is_used_in_grid&#x27; =&gt; true,</span><br><span class="line">                &#x27;is_visible_in_grid&#x27; =&gt; true,</span><br><span class="line">                &#x27;is_filterable_in_grid&#x27; =&gt; true,</span><br><span class="line">                &#x27;is_searchable_in_grid&#x27; =&gt; true,</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $attribute = $customerSetup-&gt;getEavConfig()-&gt;getAttribute(Customer::ENTITY, &#x27;c_telephone&#x27;);</span><br><span class="line"></span><br><span class="line">        $attribute-&gt;setData(</span><br><span class="line">            &#x27;used_in_forms&#x27; , [&#x27;customer_account_edit&#x27;, &#x27;customer_account_create&#x27;, &#x27;adminhtml_customer&#x27;, &#x27;adminhtml_checkout&#x27;]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $attribute-&gt;save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function getDependencies()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         * This is dependency to another patch. Dependency should be applied first</span><br><span class="line">         * One patch can have few dependencies</span><br><span class="line">         * Patches do not have versions, so if in old approach with Install/Ugrade data scripts you used</span><br><span class="line">         * versions, right now you need to point from patch with higher version to patch with lower version</span><br><span class="line">         * But please, note, that some of your patches can be independent and can be installed in any sequence</span><br><span class="line">         * So use dependencies only if this important for you</span><br><span class="line">         */</span><br><span class="line">        // return [</span><br><span class="line">        //     SomeDependency::class</span><br><span class="line">        // ];</span><br><span class="line"></span><br><span class="line">        return [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, you can use <code>getCustomAttributes</code> to get it’s value.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    $customerResp = $this-&gt;_objectManager-&gt;get(&#x27;Magento\Customer\Api\CustomerRepositoryInterface&#x27;);</span><br><span class="line">    $customer = $customerResp-&gt;getById(1);</span><br><span class="line">    // var_dump(get_class($customer));</span><br><span class="line">    // var_dump(get_class_methods($customer));</span><br><span class="line">    $customAttributes = $customer-&gt;getCustomAttributes();</span><br><span class="line"></span><br><span class="line">    var_dump(($customAttributes));</span><br><span class="line"></span><br><span class="line">    var_dump($customer-&gt;getExtensionAttributes());</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Practice-tests"><a href="#Practice-tests" class="headerlink" title="Practice tests"></a><a href="#practice-tests"></a>Practice tests</h2><p>You need to programmatically create a new customer attribute What steps are required to do this? (Multiple Choice) A. Save the attribute. B. Specify the used_in_forms data for the attribute. C. Create the attribute with \Magento\Eav\Setup\EavSetup::addAttribute D. Set the source_model value for the attribute. E. Add the attribute to the customer_eav_attribute table. Answer A B C</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a><a href="#references"></a>References</h2><p><a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/magento-2-add-customer-attribute-programmatically.html">How To Add Customer Attribute Programmatically</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/pluginsinterceptor-best-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/pluginsinterceptor-best-practice/" class="post-title-link" itemprop="url">plugins(interceptor) best practice</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-03 13:23:06" itemprop="dateCreated datePublished" datetime="2019-06-03T13:23:06+08:00">2019-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#notes"></a>Notes</h2><ul>
<li>Around-plugins SHOULD only be used when behavior of an original method is supposed to be substituted in certain scenarios.</li>
<li>Plugins SHOULD NOT be used within own module.</li>
<li>Plugins SHOULD NOT be added to data objects. ( why? )</li>
<li>Plugins MUST be stateless.</li>
<li>Plugins SHOULD NOT change the state of an intercepted object (Intercepted object is $subject).</li>
</ul>
<p>plugins SHOULD BE used for modifying the input or output of a function.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a><a href="#references"></a>References</h2><p><a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/coding-standards/technical-guidelines.html#4-interception">technical-guidelines-interception</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/plugins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/plugins/" class="post-title-link" itemprop="url">Plugins</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-03 12:24:32" itemprop="dateCreated datePublished" datetime="2019-06-03T12:24:32+08:00">2019-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#notes"></a>Notes</h2><p>Plugins Limitations: Plugins can not be used on following:</p>
<ul>
<li>Final methods</li>
<li>Final classes</li>
<li>Non-public methods</li>
<li>Class methods (such as static methods)</li>
<li>__construct</li>
<li>Virtual types</li>
<li>Objects that are instantiated before Magento\Framework\Interception is bootstrapped</li>
</ul>
<p><em>Important: plugins can be used on interfaces, abstract classes or parent classes. The plugin methods will be called for any implementation of those abstractions.</em></p>
<p>The <code>di.xml</code> file in your module declares a plugin for a class object:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;config&gt;</span><br><span class="line">    &lt;type name=&quot;&#123;ObservedType&#125;&quot;&gt;</span><br><span class="line">      &lt;plugin name=&quot;&#123;pluginName&#125;&quot; type=&quot;&#123;PluginClassName&#125;&quot; sortOrder=&quot;1&quot; disabled=&quot;false&quot; /&gt;</span><br><span class="line">    &lt;/type&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>Before methods</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    public function beforeXXX(ObserverdType, $argument1, $argument2) &#123;</span><br><span class="line">        return [$argument1, $argument2];</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>After methods</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    public function afterXXX(ObserverdType, $result, $argument1, $argument2)&#123;</span><br><span class="line">        return $result</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Around methods</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    public function aroundXXX(ObserverdType, callable $proceed, $argument1, $argument2)&#123;</span><br><span class="line">        $result = $proceed($argument1, $argument2));</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>vendor\magento\framework\Interception\Interceptor.php::___callPlugins</code></p>
<h2 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a><a href="#experiments"></a>Experiments</h2><p>Plugin A</p>
<p>Plugin B</p>
<p>Action</p>
<p>sortOrder</p>
<p>10</p>
<p>20</p>
<p>before</p>
<p>Before10</p>
<p>Before20</p>
<p>around(first half)</p>
<p>Around10 first half</p>
<p>Around20 first half</p>
<p>original</p>
<p>original dispatch</p>
<p>around(second half)</p>
<p>Around10 second half</p>
<p>Around20 second half</p>
<p>after</p>
<p>After10</p>
<p>After20</p>
<p>The execution flow will be as follows: Before10 Around10 first half Before20 Around20 first half original dispatch After20 Around20 second half After10 Around10 second half etc&#x2F;di.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:ObjectManager/etc/config.xsd&quot;&gt;</span><br><span class="line">    &lt;type name=&quot;VendorName\TestModule\Model\Attribute&quot;&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_before_10&quot; type=&quot;VendorName\TestModule\Plugin\Before10&quot; sortOrder=&quot;10&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_before_20&quot; type=&quot;VendorName\TestModule\Plugin\Before20&quot; sortOrder=&quot;20&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_around_10&quot; type=&quot;VendorName\TestModule\Plugin\Around10&quot; sortOrder=&quot;10&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_around_20&quot; type=&quot;VendorName\TestModule\Plugin\Around20&quot; sortOrder=&quot;20&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_after_10&quot; type=&quot;VendorName\TestModule\Plugin\After10&quot; sortOrder=&quot;10&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_bar_after_20&quot; type=&quot;VendorName\TestModule\Plugin\After20&quot; sortOrder=&quot;20&quot;/&gt;</span><br><span class="line">    &lt;/type&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Model;</span><br><span class="line"></span><br><span class="line">class Attribute extends  \Magento\Framework\DataObject</span><br><span class="line">&#123;</span><br><span class="line">    public function setOrderId($value)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;setData(&#x27;order_id&#x27;, $value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getOrderId()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getData(&#x27;order_id&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function setBar($value)</span><br><span class="line">    &#123;</span><br><span class="line">         return $this-&gt;setData(&#x27;bar&#x27;, $value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBar()</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;original&#x27;);</span><br><span class="line">        return $this-&gt;getData(&#x27;bar&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class Before10</span><br><span class="line">&#123;</span><br><span class="line">    public function beforeGetBar(\VendorName\TestModule\Model\Attribute $subject, $name = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;before10&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class Before20</span><br><span class="line">&#123;</span><br><span class="line">    public function beforeGetBar(\VendorName\TestModule\Model\Attribute $subject, $name = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;before20&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class Around10</span><br><span class="line">&#123;</span><br><span class="line">    public function aroundGetBar(\VendorName\TestModule\Model\Attribute $subject, callable $proceed, $name = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;around10 -- before proceed&#x27;);</span><br><span class="line"></span><br><span class="line">        $result = $proceed();</span><br><span class="line"></span><br><span class="line">        $logger-&gt;info(&#x27;around10 -- after proceed&#x27;);</span><br><span class="line"></span><br><span class="line">        return $result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class Around20</span><br><span class="line">&#123;</span><br><span class="line">    public function aroundGetBar(\VendorName\TestModule\Model\Attribute $subject, callable $proceed, $name = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;around20 -- before proceed&#x27;);</span><br><span class="line"></span><br><span class="line">        $result = $proceed();</span><br><span class="line"></span><br><span class="line">        $logger-&gt;info(&#x27;around20 -- after proceed&#x27;);</span><br><span class="line"></span><br><span class="line">        return $result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class After10</span><br><span class="line">&#123;</span><br><span class="line">    public function afterGetBar(\VendorName\TestModule\Model\Attribute $subject, $result)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;after10&#x27;);</span><br><span class="line"></span><br><span class="line">        return $result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class After20</span><br><span class="line">&#123;</span><br><span class="line">    public function afterGetBar(\VendorName\TestModule\Model\Attribute $subject, $result)</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;after20&#x27;);</span><br><span class="line"></span><br><span class="line">        return $result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we call this function, we will get our log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    $attribute = $this-&gt;_objectManager-&gt;get(&#x27;VendorName\TestModule\Model\Attribute&#x27;);</span><br><span class="line">    echo $attribute-&gt;getBar();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Log file</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2019-06-03T04:13:46+00:00 INFO (6): before10</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): around10 -- before proceed</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): before20</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): around20 -- before proceed</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): original</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): after20</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): around20 -- after proceed</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): after10</span><br><span class="line">2019-06-03T04:13:46+00:00 INFO (6): around10 -- after proceed</span><br></pre></td></tr></table></figure>

<h2 id="Practice-Tests"><a href="#Practice-Tests" class="headerlink" title="Practice Tests"></a><a href="#practice-tests"></a>Practice Tests</h2><p>You need to make some modifications to an entity before it is saved to the database. Your tool of choice is a plugin. What are requirements for a plugin? (Multiple Choice) A. The targeted method or class must not be marked final. B. The plugin method must begin with the type of the plugin. C. The plugin class must not inherit the targeted class. D. The plugin class must not be marked abstract. E. The plugin class must be specified in di.xml. Answer A B E</p>
<hr>
<p>What are valid plugin types: A. around B. instead C. post D. before E. after Answer A D E</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><a href="#reference"></a>Reference</h2><p>Code: <code>vendor\magento\framework\Interception\Interceptor.php::___callPlugins</code> <a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/plugins.html">Plugins (Interceptors)</a> I think the ‘Prioritizing plugins’ section of developer guide has error. According to our experiment, <strong>after</strong> executes before <strong>around’s second half</strong>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/id-and-frontname-in-routes-config-file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/id-and-frontname-in-routes-config-file/" class="post-title-link" itemprop="url">id and frontName in routes config file</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-30 16:28:58" itemprop="dateCreated datePublished" datetime="2019-05-30T16:28:58+08:00">2019-05-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#notes"></a>Notes</h2><p>The standard router URL structure is <code>&#123;frontName&#125;/&#123;actionPath&#125;/&#123;action&#125;</code> (standard router class: magento\framework\App\Router\Base.php::match) So, the <code>catalog/product_compare/add</code> correspond to <code>vendor\magento\module-catalog\Controller\Product\Compare\Add.php</code> The naming convention for layout.xmls is <code>&#123;route id&#125;_&#123;controller name&#125;_&#123;action name&#125;.xml</code></p>
<h2 id="Practice-tests"><a href="#Practice-tests" class="headerlink" title="Practice tests"></a><a href="#practice-tests"></a>Practice tests</h2><p>You see this code in etc&#x2F;frontend&#x2F;routes.xml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;route id=&quot;mymodule&quot; frontName=&quot;user-subscriptions&quot;&gt;</span><br><span class="line">    &lt;module name=&quot;MyCompany_MyModule&quot;/&gt;</span><br><span class="line">&lt;/route&gt;</span><br></pre></td></tr></table></figure>

<p>You have placed a controller in Controller&#x2F;Index&#x2F;Subscribe.php. At what URL would you visit the controller listed above? A. &#x2F;mymodule&#x2F;index&#x2F;subscribe B. &#x2F;mymodule&#x2F;subscribe C. &#x2F;user-subscriptions&#x2F;subscribe D. &#x2F;user-subscriptions&#x2F;index&#x2F;subscribe Answer D</p>
<hr>
<p>You see this code in etc&#x2F;adminhtml&#x2F;routes.xml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;route id=&quot;mymodule&quot; frontName=&quot;user-subscriptions&quot;&gt;</span><br><span class="line">    &lt;module name=&quot;MyCompany_MyModule&quot; /&gt;</span><br><span class="line">&lt;/route&gt;</span><br></pre></td></tr></table></figure>

<p>You have placed a controller in Controller&#x2F;Index&#x2F;Subscribe.php. If you want to create layout XML instructions for this controller, what would be the layout XML’s filename? A. user_subscriptions_subscribe_[ACTION NAME].xml B. user_subscriptions_index_subscribe.xml C. mymodule_index_subscribe.xml D. mymodule_subscribe_[ACTION NAME].xml Answer C</p>
<h2 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a><a href="#experiments"></a>Experiments</h2><p>Today we are going to use route to rewrite controller. We’ve created a simple module <code>VendorName_TestModule</code>. etc&#x2F;frontend&#x2F;routes.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:App/etc/routes.xsd&quot;&gt;</span><br><span class="line">    &lt;router id=&quot;standard&quot;&gt;</span><br><span class="line">        &lt;route frontName=&quot;test_user&quot; id=&quot;test&quot;&gt;</span><br><span class="line">            &lt;module name=&quot;VendorName_TestModule&quot;/&gt;</span><br><span class="line">        &lt;/route&gt;</span><br><span class="line">        &lt;route id=&quot;customer&quot;&gt;</span><br><span class="line">            &lt;module name=&quot;VendorName_TestModule&quot; before=&quot;Magento_Customer&quot; /&gt;</span><br><span class="line">        &lt;/route&gt;</span><br><span class="line">    &lt;/router&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace  VendorName\TestModule\Controller\Account;</span><br><span class="line"></span><br><span class="line">class Login extends\Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;customer login&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ok, after we visit <code>http://example.com/index.php/customer/account/login</code>, we will go into our controller.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><a href="#reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/207417/why-to-keep-id-and-frontname-same-in-magento-2-routes-config-file">Why to keep id and frontName same in magento 2 routes config file?</a> <a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/magento-2-routing.html">Magento 2 Routing</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/extension-attributes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/extension-attributes/" class="post-title-link" itemprop="url">extension attributes</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-29 16:38:54" itemprop="dateCreated datePublished" datetime="2019-05-29T16:38:54+08:00">2019-05-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a><a href="#requirements"></a>Requirements</h2><p>Describe how to extend existing entities. What mechanisms are available to extend existing classes, for example by adding a new attribute, a new field in the database, or a new related entity?</p>
<h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a><a href="#attention"></a>Attention</h2><p>There are two types of attributes you can use to extend Magento functionality:</p>
<ul>
<li>Custom and Entity-Attribute-Value (EAV) attributes — Custom attributes are those added on behalf of a merchant. For example, a merchant might need to add attributes to describe products, such as shape or volume. A merchant can add these attributes in the Magento Admin panel. See the merchant documentation for information about managing custom attributes.Custom attributes are a subset of EAV attributes. Objects that use EAV attributes typically store values in several MySQL tables. The Customer and Catalog modules are the primary models that use EAV attributes. Other modules, such as ConfigurableProduct, GiftMessage, and Tax, use the EAV functionality for Catalog.</li>
<li>Extension attributes. Extension attributes are new in Magento 2. They are used to extend functionality and often use more complex data types than custom attributes. These attributes do not appear in the Magento Admin.</li>
</ul>
<p>Today we are going to talk about extension attributes.</p>
<h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a><a href="#experiment"></a>Experiment</h2><h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a><a href="#preparation"></a>Preparation</h3><p>We are going to create an entity, you can skip this step. etc&#x2F;db_schema.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;schema xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Setup/Declaration/Schema/etc/schema.xsd&quot;&gt;</span><br><span class="line">  &lt;table name=&quot;order_custom_attribute&quot; resource=&quot;default&quot; engine=&quot;innodb&quot; comment=&quot;order_custom_attribute&quot;&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;int&quot; name=&quot;entity_id&quot; padding=&quot;10&quot; unsigned=&quot;true&quot; nullable=&quot;false&quot; identity=&quot;true&quot; comment=&quot;Entity ID&quot;/&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;int&quot; name=&quot;order_id&quot; padding=&quot;10&quot; unsigned=&quot;true&quot; nullable=&quot;false&quot; identity=&quot;false&quot; comment=&quot;Order ID&quot;/&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;varchar&quot; name=&quot;bar&quot; nullable=&quot;true&quot; length=&quot;255&quot; comment=&quot;bar&quot;/&gt;</span><br><span class="line">    &lt;constraint xsi:type=&quot;primary&quot; referenceId=&quot;PRIMARY&quot;&gt;</span><br><span class="line">        &lt;column name=&quot;entity_id&quot;/&gt;</span><br><span class="line">    &lt;/constraint&gt;</span><br><span class="line">    &lt;index referenceId=&quot;ORDER_CUSTOM_ATTRIBUTE_ORDER_ID&quot; indexType=&quot;btree&quot;&gt;</span><br><span class="line">      &lt;column name=&quot;order_id&quot;/&gt;</span><br><span class="line">    &lt;/index&gt;</span><br><span class="line">    &lt;constraint xsi:type=&quot;foreign&quot; referenceId=&quot;ORDER_CUSTOM_ATTRIBUTE_ORDER_ID_SALES_ORDER_ENTITY_ID&quot; table=&quot;order_custom_attribute&quot; column=&quot;order_id&quot; referenceTable=&quot;sales_order&quot; referenceColumn=&quot;entity_id&quot; /&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/schema&gt;</span><br></pre></td></tr></table></figure>

<p>you can create db_schema_whitelist.json using command <code>bin/magento setup:db-declaration:generate-whitelist --module-name=VendorName_TestModule</code> etc&#x2F;db_schema_whitelist.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;order_custom_attribute&quot;: &#123;</span><br><span class="line">        &quot;column&quot;: &#123;</span><br><span class="line">            &quot;entity_id&quot;: true,</span><br><span class="line">            &quot;order_id&quot;: true,</span><br><span class="line">            &quot;bar&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;ORDER_CUSTOM_ATTRIBUTE_ORDER_ID&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;constraint&quot;: &#123;</span><br><span class="line">            &quot;PRIMARY&quot;: true,</span><br><span class="line">            &quot;ORDER_CUSTOM_ATTRIBUTE_ORDER_ID_SALES_ORDER_ENTITY_ID&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After <code>bin/magento setup:upgrade</code>, we get <code>order_custom_attribute</code> table.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Model;</span><br><span class="line"></span><br><span class="line">class Attribute extends \Magento\Framework\Model\AbstractModel implements \VendorName\TestModule\Api\Data\AttributeInterface</span><br><span class="line">&#123;</span><br><span class="line">    protected function _construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_init(&#x27;VendorName\TestModule\Model\ResourceModel\Attribute&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function setOrderId($value)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;setData(&#x27;order_id&#x27;, $value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getOrderId()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getData(&#x27;order_id&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function setBar($value)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;setData(&#x27;bar&#x27;, $value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBar()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getData(&#x27;bar&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Api\Data;</span><br><span class="line"></span><br><span class="line">Interface AttributeInterface &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Set order id</span><br><span class="line">     * @param string $value</span><br><span class="line">     * @return $this</span><br><span class="line">     */</span><br><span class="line">    public function setOrderId($value);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get order id</span><br><span class="line">     * @return string</span><br><span class="line">     */</span><br><span class="line">    public function getOrderId();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Set bar</span><br><span class="line">     * @param string $value</span><br><span class="line">     * @return $this</span><br><span class="line">     */</span><br><span class="line">    public function setBar($value);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get bar</span><br><span class="line">     * @return string</span><br><span class="line">     */</span><br><span class="line">    public function getBar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The interface must have proper dock blocks, otherwise, when you call api, you will get an error ‘Each method must have a doc block ….’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Model\ResourceModel;</span><br><span class="line"></span><br><span class="line">class Attribute extends \Magento\Framework\Model\ResourceModel\Db\AbstractDb</span><br><span class="line">&#123;</span><br><span class="line">    protected function _construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_init(&#x27;order_custom_attribute&#x27;, &#x27;entity_id&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Model\ResourceModel\Attribute;</span><br><span class="line"></span><br><span class="line">class Collection extends \Magento\Framework\Model\ResourceModel\Db\Collection\AbstractCollection</span><br><span class="line">&#123;</span><br><span class="line">    protected function _construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_init(&#x27;VendorName\TestModule\Model\Attribute&#x27;, &#x27;VendorName\TestModule\Model\ResourceModel\Attribute&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>etc&#x2F;di.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:ObjectManager/etc/config.xsd&quot;&gt;</span><br><span class="line">    &lt;preference for=&quot;VendorName\TestModule\Api\Data\AttributeInterface&quot; type=&quot;VendorName\TestModule\Model\Attribute&quot;/&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Let’s-create-the-extension-attributes-xml-file"><a href="#Let’s-create-the-extension-attributes-xml-file" class="headerlink" title="Let’s create the extension_attributes.xml file"></a><a href="#let%E2%80%99s-create-the-extension_attributes.xml-file"></a>Let’s create the extension_attributes.xml file</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- etc/extension_attributes.xml --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Api/etc/extension_attributes.xsd&quot;&gt;</span><br><span class="line">    &lt;extension_attributes for=&quot;Magento\Sales\Api\Data\OrderInterface&quot;&gt;</span><br><span class="line">        &lt;attribute code=&quot;order_custom_attribute&quot; type=&quot;VendorName\TestModule\Api\Data\AttributeInterface&quot; /&gt;</span><br><span class="line">    &lt;/extension_attributes&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>extension attributes 依赖于 generated 中的代码，所以除了 cache:clean 之外，一定要记得删除 generated 中的代码。</p>
<h3 id="Create-a-plugin-to-save-and-retrieve-the-new-attributes"><a href="#Create-a-plugin-to-save-and-retrieve-the-new-attributes" class="headerlink" title="Create a plugin to save and retrieve the new attributes"></a><a href="#create-a-plugin-to-save-and-retrieve-the-new-attributes"></a>Create a plugin to save and retrieve the new attributes</h3><p>etc&#x2F;di.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:ObjectManager/etc/config.xsd&quot;&gt;</span><br><span class="line">    &lt;preference for=&quot;VendorName\TestModule\Api\Data\AttributeInterface&quot; type=&quot;VendorName\TestModule\Model\Attribute&quot;/&gt;</span><br><span class="line">    &lt;type name=&quot;Magento\Sales\Api\OrderRepositoryInterface&quot;&gt;</span><br><span class="line">        &lt;plugin name=&quot;save_custom_attribute&quot; type=&quot;VendorName\TestModule\Plugin\OrderSave&quot;/&gt;</span><br><span class="line">        &lt;plugin name=&quot;get_custom_attribute&quot; type=&quot;VendorName\TestModule\Plugin\OrderGet&quot;/&gt;</span><br><span class="line">    &lt;/type&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\NoSuchEntityException;</span><br><span class="line"></span><br><span class="line">class OrderGet</span><br><span class="line">&#123;</span><br><span class="line">    protected $orderExtensionFactory;</span><br><span class="line"></span><br><span class="line">    protected $attributeFactory;</span><br><span class="line"></span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Sales\Api\Data\OrderExtensionFactory $orderExtensionFactory,</span><br><span class="line">        \VendorName\TestModule\Model\AttributeFactory $attributeFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;orderExtensionFactory = $orderExtensionFactory;</span><br><span class="line">        $this-&gt;attributeFactory = $attributeFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function afterGet(</span><br><span class="line">        \Magento\Sales\Api\OrderRepositoryInterface $subject,</span><br><span class="line">        \Magento\Sales\Api\Data\OrderInterface $resultOrder</span><br><span class="line">    ) &#123;</span><br><span class="line">        $resultOrder = $this-&gt;getCustomAttribute($resultOrder);</span><br><span class="line">        return $resultOrder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function getCustomAttribute(\Magento\Sales\Api\Data\OrderInterface $order)</span><br><span class="line">    &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // The actual implementation of the repository is omitted</span><br><span class="line">            // but it is where you would load your value from the database (or any other persistent storage)</span><br><span class="line">            // $customAttribute = $this-&gt;attributeRepository-&gt;get($order-&gt;getEntityId());</span><br><span class="line"></span><br><span class="line">            // We use model load for example</span><br><span class="line">            $customAttribute = $this-&gt;attributeFactory-&gt;create();</span><br><span class="line">            $customAttribute-&gt;load($order-&gt;getEntityId());</span><br><span class="line">            if (! $customAttribute-&gt;getEntityId()) &#123;</span><br><span class="line">                throw new NoSuchEntityException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; catch (NoSuchEntityException $e) &#123;</span><br><span class="line">            return $order;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $extensionAttributes = $order-&gt;getExtensionAttributes();</span><br><span class="line">        $orderExtension = $extensionAttributes ? $extensionAttributes : $this-&gt;orderExtensionFactory-&gt;create();</span><br><span class="line"></span><br><span class="line">        $orderExtension-&gt;setOrderCustomAttribute($customAttribute);</span><br><span class="line">        $order-&gt;setExtensionAttributes($orderExtension);</span><br><span class="line"></span><br><span class="line">        return $order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Plugin;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Exception\CouldNotSaveException;</span><br><span class="line"></span><br><span class="line">class OrderSave</span><br><span class="line">&#123;</span><br><span class="line">    public function afterSave(</span><br><span class="line">        \Magento\Sales\Api\OrderRepositoryInterface $subject,</span><br><span class="line">        \Magento\Sales\Api\Data\OrderInterface $resultOrder</span><br><span class="line">    ) &#123;</span><br><span class="line">        $resultOrder = $this-&gt;saveCustomAttribute($resultOrder);</span><br><span class="line">        return $resultOrder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function saveCustomAttribute(\Magento\Sales\Api\Data\OrderInterface $order)</span><br><span class="line">    &#123;</span><br><span class="line">        $extensionAttributes = $order-&gt;getExtensionAttributes();</span><br><span class="line">        if (null !== $extensionAttributes &amp;&amp;</span><br><span class="line">            null !== $extensionAttributes-&gt;getOrderCustomAttribute()</span><br><span class="line">        ) &#123;</span><br><span class="line">            /* @var \Magento\GiftMessage\Api\Data\MessageInterface $giftMessage */</span><br><span class="line">            $customAttribute = $extensionAttributes-&gt;getOrderCustomAttribute();</span><br><span class="line">            try &#123;</span><br><span class="line"></span><br><span class="line">                // The actual implementation of the repository is omitted</span><br><span class="line">                // but it is where you would load your value from the database (or any other persistent storage)</span><br><span class="line">                // $customAttribute = $this-&gt;attributeRepository-&gt;save($order-&gt;getEntityId());</span><br><span class="line"></span><br><span class="line">                // We use model save for example</span><br><span class="line">                $customAttribute-&gt;save();</span><br><span class="line"></span><br><span class="line">            &#125; catch (\Exception $e) &#123;</span><br><span class="line">                throw new CouldNotSaveException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return $order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s create a controller for test.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    ini_set(&#x27;display_errors&#x27;, 1);</span><br><span class="line"></span><br><span class="line">    $orderResp = $this-&gt;_objectManager-&gt;get(&#x27;Magento\Sales\Api\OrderRepositoryInterface&#x27;);</span><br><span class="line">    $order = $orderResp-&gt;get(1);</span><br><span class="line">    // $order = $orderResp-&gt;get(2);</span><br><span class="line"></span><br><span class="line">    /** @param \Magento\Sales\Api\Data\OrderExtension */</span><br><span class="line">    // var_dump(get_class($order-&gt;getExtensionAttributes()));</span><br><span class="line">    // var_dump(get_class_methods($order-&gt;getExtensionAttributes()));</span><br><span class="line"></span><br><span class="line">    $extensionAttribute = $order-&gt;getExtensionAttributes();</span><br><span class="line">    $orderCustomAttribute = $extensionAttribute-&gt;getOrderCustomAttribute();</span><br><span class="line">    if ($orderCustomAttribute) &#123;</span><br><span class="line">        var_dump($orderCustomAttribute-&gt;getData());</span><br><span class="line">        $orderCustomAttribute-&gt;setBar(&#x27;898989&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $orderResp-&gt;save($order);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Magento\Sales\Api\Data\OrderInterface-&gt;getExtensionAttributes() return an instance of Magento\Sales\Api\Data\OrderExtension Magento\Sales\Api\Data\OrderExtension-&gt;getOrderCustomAttribute() (specified in extension_attributes.xml) return an instance of VendorName\TestModule\Api\Data\AttributeInterface Let’s call rest api <img src="/hellomagento2/wp-content/uploads/2019/05/extension_attributes.png"></p>
<h2 id="Practice-test"><a href="#Practice-test" class="headerlink" title="Practice test"></a><a href="#practice-test"></a>Practice test</h2><p>You are building an tool that imports products from an ERP. There are 20 columns of additional information that are associated with each product. This extra information must also be associated with an update time to know when to refresh the data. Keeping maintainability in mind, how do you build this into Magento?</p>
<ul>
<li>A. Override the Product model and add the fields.</li>
<li>B. Create a separate model and build code to associate the two record types.</li>
<li>C. Create 20 EAV attributes and check their updated_at column.</li>
<li>D. Utilize an extension attribute</li>
</ul>
<p>Answer D You are adding an extension attribute to the CustomerInterface class. You have specified data for the extension attribute, but when you check the database, nothing has been saved. Why is that? A. The appropriate columns in customer_entity have not been created. B. You need to ensure that the extension attribute getter and setter exists in CustomerExtensionInterface. C. You need to add a node to the extension attribute XML details. D. Extension attribute data is not automatically persisted to the database. Answer D <img src="/hellomagento2/wp-content/uploads/2019/06/extension_attributes_2.png"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><a href="#reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/attributes.html">EAV and extension attributes</a> <a target="_blank" rel="noopener" href="https://www.tigren.com/add-extension-attribute-magento-2/">How To Add Extension Attribute To Order In Magento 2?</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/declarative-schema/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/declarative-schema/" class="post-title-link" itemprop="url">declarative schema</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-28 15:17:08" itemprop="dateCreated datePublished" datetime="2019-05-28T15:17:08+08:00">2019-05-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a><a href="#requirements"></a>Requirements</h2><p>Demonstrate use of schema. How to manipulate columns and keys using declarative schema? What is the purpose of whitelisting? How to use Data and Schema patches? How to manage dependencies between patch files?</p>
<h2 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a><a href="#Experiments"></a>Experiments</h2><h3 id="using-db-schema-xml-to-add-a-new-table"><a href="#using-db-schema-xml-to-add-a-new-table" class="headerlink" title="using db_schema.xml to add a new table"></a><a href="#using-%60db_schema.xml%60-to-add-a-new-table"></a>using <code>db_schema.xml</code> to add a new table</h3><p>Based on 2.3.1, create a new module named VendorName_TestModule create <code>etc/db_schema.xml</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;schema xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Setup/Declaration/Schema/etc/schema.xsd&quot;&gt;</span><br><span class="line">  &lt;table name=&quot;order_custom_attribute&quot; resource=&quot;default&quot; engine=&quot;innodb&quot; comment=&quot;order_custom_attribute&quot;&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;int&quot; name=&quot;entity_id&quot; padding=&quot;10&quot; unsigned=&quot;true&quot; nullable=&quot;false&quot; identity=&quot;true&quot; comment=&quot;Entity ID&quot;/&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;varchar&quot; name=&quot;foo&quot; nullable=&quot;true&quot; length=&quot;255&quot; comment=&quot;foo&quot;/&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;varchar&quot; name=&quot;bar&quot; nullable=&quot;true&quot; length=&quot;255&quot; comment=&quot;bar&quot;/&gt;</span><br><span class="line">    &lt;constraint xsi:type=&quot;primary&quot; referenceId=&quot;PRIMARY&quot;&gt;</span><br><span class="line">      &lt;column name=&quot;entity_id&quot;/&gt;</span><br><span class="line">    &lt;/constraint&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/schema&gt;</span><br></pre></td></tr></table></figure>

<p>If you already have install or upgrade script,you can convert them to db_schema.xml files. To convert your install or upgrade script, run one of the following commands:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/magento setup:install --convert-old-scripts=1</span><br><span class="line">bin/magento setup:upgrade --convert-old-scripts=1</span><br></pre></td></tr></table></figure>

<p>To enable dry run mode, run one of the following commands:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/magento setup:install --dry-run=1</span><br><span class="line">bin/magento setup:upgrade --dry-run=1</span><br></pre></td></tr></table></figure>

<p>As a result of specifying the —dry-run&#x3D;1 flag, Magento writes a log file at &#x2F;var&#x2F;log&#x2F;dry-run-installation.log. This file contains all the DDL SQL statements that are generated during installation. You can use these SQL statements for debugging and optimizing performance processes. Next,we will create a schema whitelist. run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/magento setup:db-declaration:generate-whitelist --module-name=VendorName_TestModule</span><br></pre></td></tr></table></figure>

<p>We should get a file <code>etc/db_schema_whitelist.json</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;order_custom_attribute&quot;: &#123;</span><br><span class="line">        &quot;column&quot;: &#123;</span><br><span class="line">            &quot;entity_id&quot;: true,</span><br><span class="line">            &quot;foo&quot;: true,</span><br><span class="line">            &quot;bar&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;constraint&quot;: &#123;</span><br><span class="line">            &quot;PRIMARY&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Our module’s current version is 2.1.7 Now, run：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/magento setup:upgrade</span><br></pre></td></tr></table></figure>

<p>Check the databse, now we have the table <strong>order_custom_attribute</strong>, it has three columns (entity_id, foo, bar)</p>
<h3 id="delete-column-by-edit-db-schema-xml"><a href="#delete-column-by-edit-db-schema-xml" class="headerlink" title="delete column by edit db_schema.xml"></a><a href="#delete-column-by-edit-db_schema.xml"></a>delete column by edit db_schema.xml</h3><p>Let’s edit db_schema.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;schema xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Setup/Declaration/Schema/etc/schema.xsd&quot;&gt;</span><br><span class="line">  &lt;table name=&quot;order_custom_attribute&quot; resource=&quot;default&quot; engine=&quot;innodb&quot; comment=&quot;order_custom_attribute&quot;&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;int&quot; name=&quot;entity_id&quot; padding=&quot;10&quot; unsigned=&quot;true&quot; nullable=&quot;false&quot; identity=&quot;true&quot; comment=&quot;Entity ID&quot;/&gt;</span><br><span class="line">    &lt;column xsi:type=&quot;varchar&quot; name=&quot;foo&quot; nullable=&quot;true&quot; length=&quot;255&quot; comment=&quot;foo&quot;/&gt;</span><br><span class="line">    &lt;!--&lt;column xsi:type=&quot;varchar&quot; name=&quot;bar&quot; nullable=&quot;true&quot; length=&quot;255&quot; comment=&quot;bar&quot;/&gt;--&gt;</span><br><span class="line">    &lt;constraint xsi:type=&quot;primary&quot; referenceId=&quot;PRIMARY&quot;&gt;</span><br><span class="line">      &lt;column name=&quot;entity_id&quot;/&gt;</span><br><span class="line">    &lt;/constraint&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/schema&gt;</span><br></pre></td></tr></table></figure>

<p>We comment the bar column. Then we edit <code>etc/module.xml</code> make <code>etup_version</code> to be 2.1.8 run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/magento setup:upgrade</span><br></pre></td></tr></table></figure>

<p>Check table <code>order_custom_attribute</code>, it has two colums(entity_id, foo),the column bar has been removed. If you delete <code>db_schema_whitelist.json</code>, the column drop won’t happen.</p>
<h3 id="data-patch-example"><a href="#data-patch-example" class="headerlink" title="data patch example"></a><a href="#data-patch-example"></a>data patch example</h3><p>Let’s create a sample data patch, <code>Setup\Patch\Data\TestPatch.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace VendorName\TestModule\Setup\Patch\Data;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\Setup\Patch\DataPatchInterface;</span><br><span class="line">use Magento\Framework\Setup\Patch\PatchVersionInterface;</span><br><span class="line">use Magento\Framework\Setup\Patch\PatchRevertableInterface;</span><br><span class="line"></span><br><span class="line">class TestPatch implements DataPatchInterface, PatchRevertableInterface, PatchVersionInterface</span><br><span class="line">&#123;</span><br><span class="line">    public function getAliases()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         * This internal Magento method, that means that some patches with time can change their names,</span><br><span class="line">         * but changing name should not affect installation process, that&#x27;s why if we will change name of the patch</span><br><span class="line">         * we will add alias here</span><br><span class="line">         */</span><br><span class="line">        return [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function apply()</span><br><span class="line">    &#123;</span><br><span class="line">        // lets do something</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;TestPatch apply execute&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function getDependencies()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         * This is dependency to another patch. Dependency should be applied first</span><br><span class="line">         * One patch can have few dependencies</span><br><span class="line">         * Patches do not have versions, so if in old approach with Install/Ugrade data scripts you used</span><br><span class="line">         * versions, right now you need to point from patch with higher version to patch with lower version</span><br><span class="line">         * But please, note, that some of your patches can be independent and can be installed in any sequence</span><br><span class="line">         * So use dependencies only if this important for you</span><br><span class="line">         */</span><br><span class="line">        // return [</span><br><span class="line">        //     SomeDependency::class</span><br><span class="line">        // ];</span><br><span class="line"></span><br><span class="line">        return [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function revert()</span><br><span class="line">    &#123;</span><br><span class="line">        $writer = new \Zend\Log\Writer\Stream(BP . &#x27;/var/log/layout_block.xml&#x27;);</span><br><span class="line">        $logger = new \Zend\Log\Logger();</span><br><span class="line">        $logger-&gt;addWriter($writer);</span><br><span class="line">        $logger-&gt;info(&#x27;TestPatch revert execute&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static function getVersion()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         *  If the version number of the module in our database is higher than</span><br><span class="line">         *  the version we specify here in our file, the patch will not execute.</span><br><span class="line">         *  If it is equal to or lower than the version here, it will execute.</span><br><span class="line">         */</span><br><span class="line">        return &#x27;2.3.1&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Our module’s current version is 2.1.9, this is lower than the version (2.3.1) we specify here in our file, so, after you run <code>bin/magento setup:upgrade</code>, you will see <code>layout_block.xml</code> log. This means our patch has been applied. Also, you will see our TestPatch in patch_list table. Let’s remove it from patch_list table, and edit the version in our file to be 2.1.0, after run <code>bin/magento setup:upgrade</code>. you will see our path is added to patch_list table but not be applied. run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/magento module:uninstall --non-composer VendorName_TestModule</span><br></pre></td></tr></table></figure>

<p>Ok, our patch is removed from patch_list table and the revert function executed.</p>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#Notes"></a>Notes</h2><p>Implementing declarative schema is not a requirement for Magento 2.3. However, upgrade scripts will be phased out in favor of declarative schema Once you start with data patches, you cannot continue to use upgrade scripts. Backward compatibility must be maintained. Therefore, declarative schema does not automatically delete database tables, columns or keys that are not defined in a db_schema.xml file. Declarative schema cannot delete these elements because these items can be declared somewhere else, such as in an Setup&#x2F;UpgradeSchema.php file. The &#x2F;&#x2F;etc&#x2F;db_schema_whitelist.json file provides a history of all tables, columns, and keys added with declarative schema. It is required to allow drop operations. db_schema_whitelist.json is a temporary solution. It will be removed in the future, when upgrade scripts are no longer supported. A data patch is a class that contains data modification instructions. It is defined in a <code>&lt;Vendor&gt;/&lt;Module_Name&gt;/Setup/Patch/Data/&lt;Patch_Name&gt;.php</code> file and implements <code>\Magento\Framework\Setup\Patch\DataPatchInterface</code>. A schema patch contains custom schema modification instructions. These modifications can be complex. It is defined in a <code>&lt;Vendor&gt;/&lt;Module_Name&gt;/Setup/Patch/Schema/&lt;Patch_Name&gt;.php</code> file and implements <code>\Magento\Framework\Setup\Patch\SchemaPatchInterface</code>. Currently, use data patch to add eav attributes.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><a href="#reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/declarative-schema/data-patches.html">Develop data and schema patches</a> <a target="_blank" rel="noopener" href="https://onilab.com/blog/declarative-schema-magento-2-3-and-higher/">Declarative Schema in Magento 2.3 and Higher – a Comprehensive Review</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/install-and-upgrade-scripts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/install-and-upgrade-scripts/" class="post-title-link" itemprop="url">Install and Upgrade scripts</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-27 16:48:57" itemprop="dateCreated datePublished" datetime="2019-05-27T16:48:57+08:00">2019-05-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a><a href="#requirements"></a>Requirements</h2><p>Describe the install&#x2F;upgrade workflow. Where are setup scripts located, and how are they executed? Which types of functionality correspond to each type of setup script?</p>
<h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a><a href="#attention"></a>Attention</h2><p>Magento has introduced a new feature called <strong>Declarative Schema</strong> since 2.3 which aims to simplify the Magento installation and upgrade processes. So this is out of date on the perspective of preparing for the exam</p>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a><a href="#Notes"></a>Notes</h2><p>Install&#x2F;Upgrade scripts are located in the VendorName&#x2F;Module&#x2F;Setup directory. There are 6 types:</p>
<ul>
<li>Setup&#x2F;InstallSchema</li>
<li>Setup&#x2F;UpgradeSchema</li>
<li>Setup&#x2F;InstallData</li>
<li>Setup&#x2F;UpgradeData</li>
<li>Setup&#x2F;Recurring</li>
<li>Setup&#x2F;Uninstall</li>
</ul>
<h2 id="Practice-test"><a href="#Practice-test" class="headerlink" title="Practice test"></a><a href="#Practice-test"></a>Practice test</h2><p>You performing a code review on an existing module. You see some interesting files in the Setup&#x2F;folder. What files in the Setup&#x2F; does Magento understand? (Multiple Choice) A. Setup&#x2F;InstallSchema.php B. Setup&#x2F;Migrations&#x2F;…php C. Setup&#x2F;Recurring.php D. Setup&#x2F;UpgradeSchema.php E. Setup&#x2F;InstallDetails.php Answer A C D While integrating a merchant’s product information management system with Magento, you create a module MyCompany_MerchantPim that adds a catalog product EAV attribute pim_entity_id programmatically. In which type of setup script do you create the EAV attribute? A. Setup&#x2F;InstallSchema.php B. Setup&#x2F;UpgradeSchema.php C. Setup&#x2F;InstallEntity.php D. Setup&#x2F;UpgradeData.php Answer D UpgradeSchema.php only provides one method: upgrade. What method do you use to determine what code to execute for what method? A. Use PHP’s version_compare method to compare the $context-&gt;getVersion() with the required version. B. Use the $setup-&gt;compareVersion method. C. Put the updates into a method named containing the version number that the module is being upgraded to. D. Check the etc&#x2F;module.xml XML file for the version number. Answer A</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/magento-2-3-csrfawareactioninterface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/magento-2-3-csrfawareactioninterface/" class="post-title-link" itemprop="url">magento 2.3 CsrfAwareActionInterface</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-27 10:06:27" itemprop="dateCreated datePublished" datetime="2019-05-27T10:06:27+08:00">2019-05-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Magento has a form key validation in place for all POST non-AJAX requests - if your Action doesn’t need that validation or you want to modify it you can implement CsrfAwareActionInterface. For example</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace  VendorName\TestModule\Controller\Index;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\App\CsrfAwareActionInterface;</span><br><span class="line">use Magento\Framework\App\RequestInterface;</span><br><span class="line">use Magento\Framework\App\Request\InvalidRequestException;</span><br><span class="line"></span><br><span class="line">class Index extends \Magento\Framework\App\Action\Action implements CsrfAwareActionInterface</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public function createCsrfValidationException(RequestInterface $request): ?InvalidRequestException</span><br><span class="line">    &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function validateForCsrf(RequestInterface $request): ?bool</span><br><span class="line">    &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        $fname = $this-&gt;_request-&gt;getParam(&#x27;fname&#x27;, &#x27;help&#x27;);</span><br><span class="line">        if (method_exists($this, $fname)) &#123;</span><br><span class="line">            if ($this-&gt;checkENv()) &#123;</span><br><span class="line">                return $this-&gt;$fname();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><a href="#Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/routing.html#action-class">Routing - Action class</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/php-%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A3%B0%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/php-%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A3%B0%E6%98%8E/" class="post-title-link" itemprop="url">php 函数返回值声明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-24 13:54:52" itemprop="dateCreated datePublished" datetime="2019-05-24T13:54:52+08:00">2019-05-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>php7 支持函数返回值声明。就像下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function sum($a, $b): float &#123;</span><br><span class="line">    return $a + $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Note that a float will be returned.</span><br><span class="line">var_dump(sum(1, 2));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结果是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float(3)</span><br></pre></td></tr></table></figure>

<p>在 default weak 模式下，会自动转换返回的类型。在 strong 模式下，如果类型不正确，会抛出类型错误异常。 如果是重写父函数，那么该函数的返回值类型声明也要跟父函数一样。如果父函数没有声明返回值类型，那么子函数是可以声明的。 php7.1.0 开始，可以在冒号以前加上问号(?:) 来表示可以返回 NULL 或特定的类型 比如像这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function sum($a, $b): ?float &#123;</span><br><span class="line">    return $a + $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Note that a float will be returned.</span><br><span class="line">var_dump(sum(1, 2));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这表示可以返回 NULL 或者 float 问号不仅可以放在返回值之前，还可以放在函数参数前，表示可以为 NULL 比如这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#x27;display_errors&#x27;, 1);</span><br><span class="line"></span><br><span class="line">function test(?string $name)</span><br><span class="line">&#123;</span><br><span class="line">    var_dump($name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#x27;elePHPant&#x27;);</span><br><span class="line">test(null);</span><br><span class="line">test();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结果是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string(9) &quot;elePHPant&quot;</span><br><span class="line">null</span><br><span class="line">Uncaught Error: Too few arguments to function test(), 0 passed in...</span><br></pre></td></tr></table></figure>

<p>这并不影响默认值的用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#x27;display_errors&#x27;, 1);</span><br><span class="line"></span><br><span class="line">function test(?string $name = &#x27;dudu&#x27;)</span><br><span class="line">&#123;</span><br><span class="line">    var_dump($name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#x27;elePHPant&#x27;);</span><br><span class="line">test(null);</span><br><span class="line">test();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结果是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string(9) &quot;elePHPant&quot;</span><br><span class="line">null</span><br><span class="line">string(4) &quot;dudu&quot;</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/en/functions.returning-values.php">Returning values</a> <a target="_blank" rel="noopener" href="https://php.net/manual/en/migration71.new-features.php">Nullable types</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/hellomagento2/js-%E6%B7%B7%E6%B7%86%E5%B0%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hellomagento2/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hellomagento2/js-%E6%B7%B7%E6%B7%86%E5%B0%8F%E8%AE%B0/" class="post-title-link" itemprop="url">js 混淆小记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-15 21:08:03" itemprop="dateCreated datePublished" datetime="2019-04-15T21:08:03+08:00">2019-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hellomagento2/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前几天遇到一个 js 文件，看起来就跟乱码似的，节选如下： <img src="/hellomagento2/wp-content/uploads/2019/04/js_obfuscate.png"> 一番搜索后，发现这玩意儿 <code>\x62</code> 这种是 16 进制的表示方法。趁着这个机会，来理一理 js 中的进制转换问题吧。</p>
<h2 id="js-进制转换"><a href="#js-进制转换" class="headerlink" title="js 进制转换"></a><a href="#js-%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"></a>js 进制转换</h2><p>js 中进制转换经常用的两个函数是 <code>toString</code> 和 <code>parseInt</code></p>
<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a><a href="#%60tostring%60"></a><code>toString</code></h3><p>我们打开浏览器的 console 控制台 看例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(15).toString(); // 把 15 转换成10进制的表示形式</span><br><span class="line">&gt; 15</span><br><span class="line">(15).toString(2); // 把 15 转换成2进制的表示形式</span><br><span class="line">&gt; 1111</span><br><span class="line">(15).toString(8); // 把 15 转换成8进制的表示形式</span><br><span class="line">&gt; 17</span><br><span class="line">(15).toString(16); // 把 15 转换成16进制的表示形式</span><br><span class="line">&gt; f</span><br></pre></td></tr></table></figure>

<h3 id="parseInt"><a href="#parseInt" class="headerlink" title="parseInt"></a><a href="#%60parseint%60"></a><code>parseInt</code></h3><p>在浏览器控制台输入下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parseInt(&quot;f&quot;, 16) // 把 f 按照 16 进制转换成 10 进制的表示形式</span><br><span class="line">&gt; 15</span><br><span class="line">parseInt(&quot;17&quot;, 8)  // 把 17 按照 8 进制转换成 10 进制的表示形式</span><br><span class="line">&gt; 15</span><br><span class="line">parseInt(&quot;1111&quot;, 2) // 把 1111 按照 2 进制转换成 10 进制的表示形式</span><br><span class="line">&gt; 15</span><br><span class="line">parseInt(&quot;15&quot;, 10)</span><br><span class="line">&gt; 15</span><br></pre></td></tr></table></figure>

<p><code>parseInt</code>跟 <code>toString</code> 的转换正好是相反的。</p>
<h2 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a><a href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"></a>字符编码</h2><p>打开浏览器 console</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot;.charCodeAt() // 也就是说 A 的内部编码值是 65</span><br><span class="line">&gt; 65</span><br><span class="line">String.fromCharCode(65) // 65 这个编码值对应着字符 A</span><br><span class="line">&quot;A&quot;</span><br></pre></td></tr></table></figure>

<p>这里的 65 指的都是十进制的。</p>
<h2 id="js-中二进制，八进制，十六进制表示"><a href="#js-中二进制，八进制，十六进制表示" class="headerlink" title="js 中二进制，八进制，十六进制表示"></a><a href="#js-%E4%B8%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%EF%BC%8C%E5%85%AB%E8%BF%9B%E5%88%B6%EF%BC%8C%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA"></a>js 中二进制，八进制，十六进制表示</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(0x6D)  // 十六进制 0x 开头</span><br><span class="line">&gt; 109</span><br><span class="line">console.log(0155) // 八进制  0 开头</span><br><span class="line">&gt; 109</span><br><span class="line">console.log(0b01101101) // 二进制 0b 开头</span><br><span class="line">&gt; 109</span><br></pre></td></tr></table></figure>

<h2 id="字符串转义"><a href="#字符串转义" class="headerlink" title="字符串转义"></a><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E4%B9%89"></a>字符串转义</h2><p>Character</p>
<p>Meaning</p>
<p>\0</p>
<p>Null Byte</p>
<p>\b</p>
<p>Backspace</p>
<p>\f</p>
<p>Form feed</p>
<p>\n</p>
<p>New line</p>
<p>\r</p>
<p>Carriage return</p>
<p>\t</p>
<p>Tab</p>
<p>\v</p>
<p>Vertical tab</p>
<p>\’</p>
<p>Apostrophe or single quote</p>
<p>\”</p>
<p>Double quote</p>
<p>\</p>
<p>Backslash character</p>
<p>\XXX</p>
<p>The character with the Latin-1 encoding specified by up to three octal digits XXX between 0 and 377. For example, \251 is the octal sequence for the copyright symbol.</p>
<p>\xXX</p>
<p>The character with the Latin-1 encoding specified by the two hexadecimal digits XX between 00 and FF. For example, \xA9 is the hexadecimal sequence for the copyright symbol.</p>
<p>\uXXXX</p>
<p>The Unicode character specified by the four hexadecimal digits XXXX. For example, \u00A9 is the Unicode sequence for the copyright symbol. See Unicode escape sequences.</p>
<p>\u{XXXXX}</p>
<p>Unicode code point escapes. For example, \u{2F804} is the same as the simple Unicode escapes \uD87E\uDC04.</p>
<p>(以上摘自 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#String_literals">Grammar_and_types#String_literals</a>) 这下就清楚了，遇到 ‘\XXX’ 就按照八进制解码，遇到 ‘\xXX’ 就按照 16 进制解码。 比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#x27;\x64&#x27;);</span><br><span class="line">&gt; d</span><br></pre></td></tr></table></figure>

<h2 id="免费工具"><a href="#免费工具" class="headerlink" title="免费工具"></a><a href="#%E5%85%8D%E8%B4%B9%E5%B7%A5%E5%85%B7"></a>免费工具</h2><p>js 加密（混淆）防君子防不住小人的。如果我们只是想增加别人阅读的困难，用一些免费工具，混淆一下，变量名无意义了，就很难看懂了。免费混淆工具 <a target="_blank" rel="noopener" href="http://javascriptobfuscator.com/Javascript-Obfuscator.aspx">javascriptobfuscator.com</a> 解密工具 <a target="_blank" rel="noopener" href="https://www.sojson.com/jsjiemi.html">www.sojson.com</a></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="http://blog.knownsec.com/2015/08/use-estools-aid-deobfuscate-javascript/">使用 estools 辅助反混淆 Javascript</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/52cik/p/js-string-escape.html">浅谈 js 字符串之神奇的转义</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hellomagento2/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/hellomagento2/">1</a><span class="space">&hellip;</span><a class="page-number" href="/hellomagento2/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/hellomagento2/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/hellomagento2/page/32/">32</a><a class="extend next" rel="next" href="/hellomagento2/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hellomagento2/archives/">
        
          <span class="site-state-item-count">313</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hellomagento2/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hellomagento2/tags/">
          
        <span class="site-state-item-count">136</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/hellomagento2/lib/anime.min.js"></script>
  <script src="/hellomagento2/lib/velocity/velocity.min.js"></script>
  <script src="/hellomagento2/lib/velocity/velocity.ui.min.js"></script>

<script src="/hellomagento2/js/utils.js"></script>

<script src="/hellomagento2/js/motion.js"></script>


<script src="/hellomagento2/js/schemes/pisces.js"></script>


<script src="/hellomagento2/js/next-boot.js"></script>




  




  
<script src="/hellomagento2/js/local-search.js"></script>













  

  

</body>
</html>
