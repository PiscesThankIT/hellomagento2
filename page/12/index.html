<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/cropped-favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cropped-favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cropped-favicon-16x16.png">
  <link rel="mask-icon" href="/images/cropped-favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="{ Hello Magento 2 }">
<meta property="og:url" content="http://example.com/page/12/index.html">
<meta property="og:site_name" content="{ Hello Magento 2 }">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ThankIT">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>{ Hello Magento 2 }</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">{ Hello Magento 2 }</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">解决 Magento 2 应用问题，更注重深度挖掘。(ง •̀_•́)ง</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/requirejs-%E7%9A%84-shim-%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/requirejs-%E7%9A%84-shim-%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">RequireJS 的 shim 用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-30 01:20:16" itemprop="dateCreated datePublished" datetime="2017-09-30T01:20:16+08:00">2017-09-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a><a href="#%E7%BB%BC%E8%BF%B0"></a>综述</h2><p>RequireJS 遵循 <a target="_blank" rel="noopener" href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD 规范</a>（异步模块定义）。理论上来说，RequireJS 加载的模块必须符合 AMD 规范，使用 define() 函数定义。但是，由于历史原因，大量的 js 库并不符合规范。这样加载非规范的模块，就需要用到 <code>shim</code> 比如 underscore 和 backbone 都不符合 AMD 规范，如果要加载他们，就要像这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">require.config(&#123;</span><br><span class="line">　　　　shim: &#123;</span><br><span class="line">　　　　　　&#x27;underscore&#x27;:&#123;</span><br><span class="line">　　　　　　　　exports: &#x27;_&#x27;</span><br><span class="line">　　　　　　&#125;,</span><br><span class="line">　　　　　　&#x27;backbone&#x27;: &#123;</span><br><span class="line">　　　　　　　　deps: [&#x27;underscore&#x27;, &#x27;jquery&#x27;],</span><br><span class="line">　　　　　　　　exports: &#x27;Backbone&#x27;</span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;);</span><br></pre></td></tr></table></figure>

<p><code>exports</code> 是模块的返回值，该值一定要与库暴露的全局变量名称一致。 <code>deps</code> 表明模块的依赖，如果 A 模块依赖于 B 模块，而 A 模块不符合 AMD 规范，使用全局变量，那么 B 模块也必须使用全局变量，不然 A 模块会找不到 B 模块的依赖对象而报错。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a><a href="#%E5%87%86%E5%A4%87"></a>准备</h2><p>下面开始做实验。 File: test.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;shim&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/require.js/2.3.5/require.min.js&quot; data-main=&quot;main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>File: a.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 立即执行函数，不暴露私有成员</span><br><span class="line">(function(window)&#123;</span><br><span class="line">    var a = &#123;&#125;;</span><br><span class="line">    a.sayHello = function()&#123;</span><br><span class="line">        alert(&quot;Hello this is A&quot;);</span><br><span class="line">        return &#x27;Hello&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    window.a = a;</span><br><span class="line">&#125;)(window)</span><br></pre></td></tr></table></figure>

<p>File: main.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require([&#x27;a&#x27;],function(a) &#123;</span><br><span class="line">    console.log(a);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>载入文档，在 console 中我们会看到，输出 <code>undefined</code> <img src="/wp-content/uploads/2017/09/shim-1.png" alt="a is not defined"> 但是我们查看浏览器的 element 和 network 会发现，实际上 a.js 已经被加载进来了。 <img src="/wp-content/uploads/2017/09/shim-2.png" alt="a.js has been loaded"> <img src="/wp-content/uploads/2017/09/shim-3.png" alt="a.js has been loaded network"> 下面我们在 console 中输入:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.sayHello();</span><br></pre></td></tr></table></figure>

<p><img src="/wp-content/uploads/2017/09/shim-4.gif" alt="console 中输入命令"> 可以看出实际上 a.js 中暴露的全局变量还是存在的。</p>
<h2 id="使用-shim"><a href="#使用-shim" class="headerlink" title="使用 shim"></a><a href="#%E4%BD%BF%E7%94%A8-%60shim%60"></a>使用 <code>shim</code></h2><p>下面我们用 <code>shim</code> 让 RequireJS 可以获得暴露的全局变量作为返回值。 修改 <code>main.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">    shim: &#123;</span><br><span class="line">        a:&#123;</span><br><span class="line">            deps:[],</span><br><span class="line">            exports: &#x27;a&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">require([&#x27;a&#x27;],function(a) &#123;</span><br><span class="line">    console.log(a);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后刷新文档，这次肯定是输出内容了。 <img src="/wp-content/uploads/2017/09/shim-5.png" alt="exports 有效"> 如果我们把 <code>exports: &#39;a&#39;</code> 改成 <code>exports: &#39;something&#39;</code> 那么再刷新，一定会发现又输出 <code>undefined</code> <em>所以，<code>exports</code> 是模块的返回值，该值一定要与库暴露的全局变量名称一致。</em></p>
<h2 id="使用-deps"><a href="#使用-deps" class="headerlink" title="使用 deps"></a><a href="#%E4%BD%BF%E7%94%A8-%60deps%60"></a>使用 <code>deps</code></h2><p>下面来实验 <code>deps</code> 的用法，假设 a.js 依赖于 b.js</p>
<h3 id="正确的写法"><a href="#正确的写法" class="headerlink" title="正确的写法"></a><a href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%86%99%E6%B3%95"></a>正确的写法</h3><p>File: b.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var b = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">console.log(&#x27;b&#x27;);</span><br><span class="line"></span><br><span class="line">b.string = &#x27;Hello, this is a string from b.js&#x27;;</span><br><span class="line">b.getString = function() &#123;</span><br><span class="line">    return this.string;</span><br><span class="line">&#125;</span><br><span class="line">b.setString = function(string) &#123;</span><br><span class="line">    this.string = string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File: a.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 立即执行函数，不暴露私有成员</span><br><span class="line">(function(window)&#123;</span><br><span class="line">    console.log(&#x27;a&#x27;);</span><br><span class="line"></span><br><span class="line">    var a = &#123;&#125;;</span><br><span class="line">    a.sayHello = function()&#123;</span><br><span class="line">        alert(&quot;Hello this is A&quot;);</span><br><span class="line">        return &#x27;Hello&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    a.getBString = function() &#123;</span><br><span class="line">        alert(b.getString());</span><br><span class="line">    &#125;</span><br><span class="line">    window.a = a;</span><br><span class="line">&#125;)(window)</span><br></pre></td></tr></table></figure>

<p>File:main.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">    shim: &#123;</span><br><span class="line">        a:&#123;</span><br><span class="line">            deps:[&#x27;b&#x27;],</span><br><span class="line">            exports: &#x27;a&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        b: &#123;</span><br><span class="line">            deps:[],</span><br><span class="line">            exports: &#x27;b&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">require([&#x27;a&#x27;],function(aAlias) &#123;</span><br><span class="line"></span><br><span class="line">    aAlias.getBString();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下： <img src="/wp-content/uploads/2017/09/shim-6.png" alt="depes 用法效果"> 这是标准的写法，下面我们来实验一个不好的写法。</p>
<h3 id="错误的写法"><a href="#错误的写法" class="headerlink" title="错误的写法"></a><a href="#%E9%94%99%E8%AF%AF%E7%9A%84%E5%86%99%E6%B3%95"></a>错误的写法</h3><p>将 main.js 改成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">    shim: &#123;</span><br><span class="line">        a:&#123;</span><br><span class="line">            deps:[],</span><br><span class="line">            exports: &#x27;a&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        b: &#123;</span><br><span class="line">            deps:[],</span><br><span class="line">            exports: &#x27;b&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">require([&#x27;a&#x27;,&#x27;b&#x27;],function(aAlias, bAlias) &#123;</span><br><span class="line"></span><br><span class="line">    aAlias.getBString();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们并没有声明 a.js 依赖 b.js 而是在使用的时候将 b.js require 进来了。这样在本例中也是正常的。但仅仅是因为本例太简单，对执行的先后顺序没有要求而已，换个场景可能就失效了。 <code>require([&#39;a&#39;,&#39;b&#39;],function(aAlias, bAlias)</code> 仅仅表示 a b 都加载完成后，执行回调函数，但是 加载的顺序是不固定的。执行的顺序是固定的，按照依赖声明的先后顺序执行。 在上面我们埋了 <code>console.log(&#39;a)</code> 和 <code>console.log(&#39;b&#39;)</code> 那么在不好的写法中，控制台中打印的顺序是不固定的，有时候是 <code>a b</code> 有时候是 <code>b a</code> ，而正确的例子中，指定顺序是固定的，一定是 <code>b a</code> 下面是错误的写法，多次刷新的结果，可以看出，顺序是有变化的。 <img src="/wp-content/uploads/2017/09/shim-7.gif" alt="执行顺序不一定"></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/aitangyong/article/details/44225859">使用requireJS加载不符合AMD规范的js文件：shim的使用方式和实现原理</a> <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html">Javascript模块化编程（二）：AMD规范</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/how-to-create-admin-grid-in-magento-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/how-to-create-admin-grid-in-magento-2/" class="post-title-link" itemprop="url">How to Create Admin Grid in Magento 2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-25 17:04:41" itemprop="dateCreated datePublished" datetime="2017-09-25T17:04:41+08:00">2017-09-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Admin Grid 是一种表格，用来展示数据库表中的记录，附带一些额外的特性：排序、筛选、删除更新等。Admin Grid 的创建有两种方式：使用 layout 和使用 component 。本篇是利用 component 创建的 Admin Grid 。 文章中涉及的内容太多了，还有很多地方可以分解和完善，先发出来，作为初探，或者是索引以供后续研究。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a><a href="#%E5%89%8D%E6%8F%90"></a>前提</h2><p>以 <code>ThankIT_HelloWorld</code> 模块为基础，已经通过 InstallSchema 添加了数据表，创建了 Admin Menu 和 ACL 如果没有，参考以下文章： <a href="/crud-models-in-magento-2">CRUD Models in Magento 2</a> <a href="/magento-2-create-admin-menu">Magento 2 Create Admin Menu</a> <a href="/magento-2-admin-acl-access-control-lists">Magento 2 Admin ACL Access Control Lists</a> 我们的 admin menu 创建了一个后台 path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thankit_helloworld/post/index</span><br></pre></td></tr></table></figure>

<h2 id="创建-routes-xml"><a href="#创建-routes-xml" class="headerlink" title="创建 routes.xml"></a><a href="#%E5%88%9B%E5%BB%BA-routes.xml"></a>创建 routes.xml</h2><p>File: app\code\ThankIT\HelloWorld\etc\adminhtml\routes.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../../lib/internal/Magento/Framework/App/etc/routes.xsd&quot;&gt;</span><br><span class="line">    &lt;router id=&quot;admin&quot;&gt;</span><br><span class="line">        &lt;route id=&quot;thankit_helloworld&quot; frontName=&quot;thankit_helloworld&quot;&gt;</span><br><span class="line">            &lt;module name=&quot;ThankIT_HelloWorld&quot; after=&quot;Magento_Backend&quot;/&gt;</span><br><span class="line">        &lt;/route&gt;</span><br><span class="line">    &lt;/router&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<h2 id="创建-controller"><a href="#创建-controller" class="headerlink" title="创建 controller"></a><a href="#%E5%88%9B%E5%BB%BA-controller"></a>创建 controller</h2><p>File:app\code\ThankIT\HelloWorld\Controller\Adminhtml\Post\Index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Adminhtml\Post;</span><br><span class="line"></span><br><span class="line">class Index extends \Magento\Backend\App\Action</span><br><span class="line">&#123;</span><br><span class="line">    const ADMIN_RESOURCE = &#x27;ThankIT_HelloWorld::post&#x27;;</span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Backend\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        $page = $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">        // var_dump(get_class($page));</span><br><span class="line">        // &#x27;Magento\Backend\Model\View\Result\Page\Interceptor&#x27; (length=50)</span><br><span class="line">        // 如果没有下面这句，title 是 Magento Admin ，active menu 正常</span><br><span class="line">        // 如果下面这句的 id 不存在，则 active menu 不正常 title 还是 Magento Admin</span><br><span class="line">        $page-&gt;setActiveMenu(&#x27;ThankIT_HelloWorld::post&#x27;);</span><br><span class="line">        // title 替换成 Posts</span><br><span class="line">        $page-&gt;getConfig()-&gt;getTitle()-&gt;prepend((__(&#x27;Posts&#x27;)));</span><br><span class="line"></span><br><span class="line">        // class: Magento\Backend\Model\View\Result\Page</span><br><span class="line">        // addBreadcrumb($label, $title, $link = null)</span><br><span class="line">        $page-&gt;addBreadcrumb(__(&#x27;ThankIT&#x27;), __(&#x27;ThankIT&#x27;));</span><br><span class="line">        $page-&gt;addBreadcrumb(__(&#x27;Hello World&#x27;), __(&#x27;Manage Blogs&#x27;));</span><br><span class="line">        return $page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建-layout"><a href="#创建-layout" class="headerlink" title="创建 layout"></a><a href="#%E5%88%9B%E5%BB%BA-layout"></a>创建 layout</h2><p>File: app\code\ThankIT\HelloWorld\view\adminhtml\layout\thankit_helloworld_post_index.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;page xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../../../lib/internal/Magento/Framework/View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;update handle=&quot;styles&quot;/&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;referenceContainer name=&quot;content&quot;&gt;</span><br><span class="line">            &lt;uiComponent name=&quot;thankit_helloworld_post_listing&quot;/&gt;</span><br><span class="line">        &lt;/referenceContainer&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>注意我们这里声明的 <code>uiComponent name=&quot;thankit_helloworld_post_listing&quot;</code></p>
<h2 id="创建-component-layout-file"><a href="#创建-component-layout-file" class="headerlink" title="创建 component layout file"></a><a href="#%E5%88%9B%E5%BB%BA-component-layout-file"></a>创建 component layout file</h2><p>File:app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;view&#x2F;adminhtml&#x2F;ui_component&#x2F;thankit_helloworld_post_listing.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;listing xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:module:Magento_Ui:etc/ui_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">        &lt;item name=&quot;js_config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing_data_source&lt;/item&gt;</span><br><span class="line">            &lt;item name=&quot;deps&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing_data_source&lt;/item&gt;</span><br><span class="line">        &lt;/item&gt;</span><br><span class="line">        &lt;item name=&quot;spinner&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_columns&lt;/item&gt;</span><br><span class="line">        &lt;item name=&quot;buttons&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;add&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;name&quot; xsi:type=&quot;string&quot;&gt;add&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Add New Post&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;class&quot; xsi:type=&quot;string&quot;&gt;primary&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;url&quot; xsi:type=&quot;string&quot;&gt;*/*/new&lt;/item&gt;</span><br><span class="line">            &lt;/item&gt;</span><br><span class="line">        &lt;/item&gt;</span><br><span class="line">    &lt;/argument&gt;</span><br><span class="line">    &lt;dataSource name=&quot;thankit_helloworld_post_listing_data_source&quot;&gt;</span><br><span class="line">        &lt;argument name=&quot;dataProvider&quot; xsi:type=&quot;configurableObject&quot;&gt;</span><br><span class="line">            &lt;!-- &lt;argument name=&quot;class&quot; xsi:type=&quot;string&quot;&gt;ThankITHelloWorldPostGridDataProvider&lt;/argument&gt; --&gt;</span><br><span class="line">            &lt;argument name=&quot;class&quot; xsi:type=&quot;string&quot;&gt;Magento\Framework\View\Element\UiComponent\DataProvider\DataProvider&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;name&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing_data_source&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;primaryFieldName&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;requestFieldName&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;update_url&quot; xsi:type=&quot;url&quot; path=&quot;mui/index/render&quot;/&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/argument&gt;</span><br><span class="line">        &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;js_config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/provider&lt;/item&gt;</span><br><span class="line">            &lt;/item&gt;</span><br><span class="line">        &lt;/argument&gt;</span><br><span class="line">    &lt;/dataSource&gt;</span><br><span class="line">    &lt;container name=&quot;listing_top&quot;&gt;</span><br><span class="line">        &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;template&quot; xsi:type=&quot;string&quot;&gt;ui/grid/toolbar&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;stickyTmpl&quot; xsi:type=&quot;string&quot;&gt;ui/grid/sticky/toolbar&lt;/item&gt;</span><br><span class="line">            &lt;/item&gt;</span><br><span class="line">        &lt;/argument&gt;</span><br><span class="line">        &lt;bookmark name=&quot;bookmarks&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/bookmark&gt;</span><br><span class="line">        &lt;component name=&quot;columns_controls&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;columnsData&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/controls/columns&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;displayArea&quot; xsi:type=&quot;string&quot;&gt;dataGridActions&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/component&gt;</span><br><span class="line">        &lt;exportButton name=&quot;export_button&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;selectProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns.ids&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/exportButton&gt;</span><br><span class="line">        &lt;filterSearch name=&quot;fulltext&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing_data_source&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;chipsProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.listing_filters_chips&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.bookmarks&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;current.search&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/filterSearch&gt;</span><br><span class="line">        &lt;filters name=&quot;listing_filters&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;columnsProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.bookmarks&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;current.filters&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;templates&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;filters&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;select&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                                &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/form/element/ui-select&lt;/item&gt;</span><br><span class="line">                                &lt;item name=&quot;template&quot; xsi:type=&quot;string&quot;&gt;ui/grid/filters/elements/ui-select&lt;/item&gt;</span><br><span class="line">                            &lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;childDefaults&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.listing_filters&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;imports&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;visible&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns.$&#123; $.index &#125;:visible&lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;observers&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;column&quot; xsi:type=&quot;string&quot;&gt;column&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/filters&gt;</span><br><span class="line">        &lt;massaction name=&quot;listing_massaction&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;selectProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns.ids&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;indexField&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">            &lt;action name=&quot;delete&quot;&gt;</span><br><span class="line">                &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;type&quot; xsi:type=&quot;string&quot;&gt;delete&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Delete&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;url&quot; xsi:type=&quot;url&quot; path=&quot;thankit_helloworld/post/massDelete&quot;/&gt;</span><br><span class="line">                        &lt;item name=&quot;confirm&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;title&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Delete Posts&lt;/item&gt;</span><br><span class="line">                            &lt;item name=&quot;message&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Are you sure you wan&#x27;t to delete selected Posts?&lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/argument&gt;</span><br><span class="line">            &lt;/action&gt;</span><br><span class="line">            &lt;action name=&quot;edit&quot;&gt;</span><br><span class="line">                &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;type&quot; xsi:type=&quot;string&quot;&gt;edit&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Edit&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;callback&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns_editor&lt;/item&gt;</span><br><span class="line">                            &lt;item name=&quot;target&quot; xsi:type=&quot;string&quot;&gt;editSelected&lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/argument&gt;</span><br><span class="line">            &lt;/action&gt;</span><br><span class="line">        &lt;/massaction&gt;</span><br><span class="line">        &lt;paging name=&quot;listing_paging&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.bookmarks&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;current.paging&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;selectProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns.ids&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/paging&gt;</span><br><span class="line">    &lt;/container&gt;</span><br><span class="line">    &lt;columns name=&quot;thankit_helloworld_post_columns&quot;&gt;</span><br><span class="line">        &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.bookmarks&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;current&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;editorConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;selectProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns.ids&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;enabled&quot; xsi:type=&quot;boolean&quot;&gt;true&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;indexField&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;clientConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;saveUrl&quot; xsi:type=&quot;url&quot; path=&quot;thankit_helloworld/post/inlineEdit&quot;/&gt;</span><br><span class="line">                        &lt;item name=&quot;validateBeforeSave&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;childDefaults&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;fieldAction&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns_editor&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;target&quot; xsi:type=&quot;string&quot;&gt;startEdit&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;params&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;0&quot; xsi:type=&quot;string&quot;&gt;$&#123; $.$data.rowIndex &#125;&lt;/item&gt;</span><br><span class="line">                            &lt;item name=&quot;1&quot; xsi:type=&quot;boolean&quot;&gt;true&lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;storageConfig&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;provider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top.bookmarks&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;root&quot; xsi:type=&quot;string&quot;&gt;columns.$&#123; $.index &#125;&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;namespace&quot; xsi:type=&quot;string&quot;&gt;current.$&#123; $.storageConfig.root&#125;&lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/item&gt;</span><br><span class="line">        &lt;/argument&gt;</span><br><span class="line">        &lt;selectionsColumn name=&quot;ids&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;resizeEnabled&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;resizeDefaultWidth&quot; xsi:type=&quot;string&quot;&gt;55&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;indexField&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/selectionsColumn&gt;</span><br><span class="line">        &lt;column name=&quot;post_id&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;textRange&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;sorting&quot; xsi:type=&quot;string&quot;&gt;asc&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;ID&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;name&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;editor&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;editorType&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                        &lt;item name=&quot;validation&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;required-entry&quot; xsi:type=&quot;boolean&quot;&gt;true&lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Name&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;url_key&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;visible&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;URL Key&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;tags&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;visible&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Tags&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;text&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;status&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;options&quot; xsi:type=&quot;object&quot;&gt;Magento\Config\Model\Config\Source\Yesno&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;select&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Status&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/columns/select&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;select&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;sample_country_selection&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;options&quot; xsi:type=&quot;object&quot;&gt;Magento\Config\Model\Config\Source\Locale\Country&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;select&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;visible&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Sample Country Selection&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/columns/select&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;select&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;created_at&quot; class=&quot;Magento\Ui\Component\Listing\Columns\Date&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;dateRange&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/columns/date&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;date&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Created&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;column name=&quot;updated_at&quot; class=&quot;Magento\Ui\Component\Listing\Columns\Date&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;filter&quot; xsi:type=&quot;string&quot;&gt;dateRange&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/columns/date&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;dataType&quot; xsi:type=&quot;string&quot;&gt;date&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;label&quot; xsi:type=&quot;string&quot; translate=&quot;true&quot;&gt;Modified&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/column&gt;</span><br><span class="line">        &lt;actionsColumn name=&quot;actions&quot; class=&quot;ThankIT\HelloWorld\Ui\Component\Listing\Column\PostActions&quot;&gt;</span><br><span class="line">            &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                    &lt;item name=&quot;resizeEnabled&quot; xsi:type=&quot;boolean&quot;&gt;false&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;resizeDefaultWidth&quot; xsi:type=&quot;string&quot;&gt;107&lt;/item&gt;</span><br><span class="line">                    &lt;item name=&quot;indexField&quot; xsi:type=&quot;string&quot;&gt;post_id&lt;/item&gt;</span><br><span class="line">                &lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/actionsColumn&gt;</span><br><span class="line">    &lt;/columns&gt;</span><br><span class="line">    &lt;container name=&quot;sticky&quot;&gt;</span><br><span class="line">        &lt;argument name=&quot;data&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">            &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;Magento_Ui/js/grid/sticky/sticky&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;toolbarProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.listing_top&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;listingProvider&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_listing.thankit_helloworld_post_listing.thankit_helloworld_post_columns&lt;/item&gt;</span><br><span class="line">            &lt;/item&gt;</span><br><span class="line">        &lt;/argument&gt;</span><br><span class="line">    &lt;/container&gt;</span><br><span class="line">&lt;/listing&gt;</span><br></pre></td></tr></table></figure>

<p>代码比较长，一段一段来分析。 我们在 layout 中声明的 listing name 是 <code>thankit_helloworld_post_listing</code> <img src="/wp-content/uploads/2017/09/thankit-helloworld-post-listing.png" alt="thankit-helloworld-post-listing.png"> 这里面经常用到的有四个元素，<code>&lt;argument&gt;</code>,<code>&lt;dataSource&gt;</code>,<code>&lt;columns&gt;</code>,<code>&lt;container&gt;</code>,这几个元素间的粗略关系见上图。 这个里面声明了一个 dataSource <code>thankit_helloworld_post_listing_data_source</code></p>
<h2 id="di-xml"><a href="#di-xml" class="headerlink" title="di.xml"></a><a href="#di.xml"></a>di.xml</h2><p>File: app\code\ThankIT\HelloWorld\etc\di.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../lib/internal/Magento/Framework/ObjectManager/etc/config.xsd&quot;&gt;</span><br><span class="line">    &lt;type name=&quot;Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory&quot;&gt;</span><br><span class="line">        &lt;arguments&gt;</span><br><span class="line">            &lt;argument name=&quot;collections&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;thankit_helloworld_post_listing_data_source&quot; xsi:type=&quot;string&quot;&gt;ThankIT\HelloWorld\Model\ResourceModel\Post\Grid\Collection&lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/arguments&gt;</span><br><span class="line">    &lt;/type&gt;</span><br><span class="line">    &lt;type name=&quot;ThankIT\HelloWorld\Model\ResourceModel\Post\Grid\Collection&quot;&gt;</span><br><span class="line">        &lt;arguments&gt;</span><br><span class="line">            &lt;argument name=&quot;mainTable&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;eventPrefix&quot; xsi:type=&quot;string&quot;&gt;thankit_helloworld_post_grid_collection&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;eventObject&quot; xsi:type=&quot;string&quot;&gt;post_grid_collection&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;resourceModel&quot; xsi:type=&quot;string&quot;&gt;ThankIT\HelloWorld\Model\ResourceModel\Post&lt;/argument&gt;</span><br><span class="line">        &lt;/arguments&gt;</span><br><span class="line">    &lt;/type&gt;</span><br><span class="line">    &lt;!-- start 这一段可以不要 --&gt;</span><br><span class="line">    &lt;!-- &lt;virtualType name=&quot;ThankITHelloWorldPostGridDataProvider&quot; type=&quot;Magento\Framework\View\Element\UiComponent\DataProvider\DataProvider&quot;&gt;</span><br><span class="line">        &lt;arguments&gt;</span><br><span class="line">            &lt;argument name=&quot;collection&quot; xsi:type=&quot;object&quot; shared=&quot;false&quot;&gt;ThankIT\HelloWorld\Model\ResourceModel\Post\Collection&lt;/argument&gt;</span><br><span class="line">            &lt;argument name=&quot;filterPool&quot; xsi:type=&quot;object&quot; shared=&quot;false&quot;&gt;ThankITHelloWorldGirdFilterPool&lt;/argument&gt;</span><br><span class="line">        &lt;/arguments&gt;</span><br><span class="line">    &lt;/virtualType&gt;</span><br><span class="line">    &lt;virtualType name=&quot;ThankITHelloWorldGirdFilterPool&quot; type=&quot;Magento\Framework\View\Element\UiComponent\DataProvider\FilterPool&quot;&gt;</span><br><span class="line">        &lt;arguments&gt;</span><br><span class="line">            &lt;argument name=&quot;appliers&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                &lt;item name=&quot;regular&quot; xsi:type=&quot;object&quot;&gt;Magento\Framework\View\Element\UiComponent\DataProvider\RegularFilter&lt;/item&gt;</span><br><span class="line">                &lt;item name=&quot;fulltext&quot; xsi:type=&quot;object&quot;&gt;Magento\Framework\View\Element\UiComponent\DataProvider\FulltextFilter&lt;/item&gt;</span><br><span class="line">            &lt;/argument&gt;</span><br><span class="line">        &lt;/arguments&gt;</span><br><span class="line">    &lt;/virtualType&gt; --&gt;</span><br><span class="line">    &lt;!-- end 这一段可以不要 --&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>其中重要部分如下图： <img src="/wp-content/uploads/2017/09/di.xml_.png" alt="di.xml"></p>
<h2 id="Grid-Collection"><a href="#Grid-Collection" class="headerlink" title="Grid Collection"></a><a href="#grid-collection"></a>Grid Collection</h2><p>File: ThankIT\HelloWorld\Model\ResourceModel\Post\Grid\Collection;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Model\ResourceModel\Post\Grid;</span><br><span class="line"></span><br><span class="line">class Collection extends \ThankIT\HelloWorld\Model\ResourceModel\Post\Collection implements \Magento\Framework\Api\Search\SearchResultInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * Aggregations</span><br><span class="line">     *</span><br><span class="line">     * @var \Magento\Framework\Search\AggregationInterface</span><br><span class="line">     */</span><br><span class="line">    protected $_aggregations;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\Data\Collection\EntityFactoryInterface $entityFactory</span><br><span class="line">     * @param \Psr\Log\LoggerInterface $logger</span><br><span class="line">     * @param \Magento\Framework\Data\Collection\Db\FetchStrategyInterface $fetchStrategy</span><br><span class="line">     * @param \Magento\Framework\Event\ManagerInterface $eventManager</span><br><span class="line">     * @param $mainTable</span><br><span class="line">     * @param $eventPrefix</span><br><span class="line">     * @param $eventObject</span><br><span class="line">     * @param $resourceModel</span><br><span class="line">     * @param $model</span><br><span class="line">     * @param $connection</span><br><span class="line">     * @param \Magento\Framework\Model\ResourceModel\Db\AbstractDb $resource</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\Data\Collection\EntityFactoryInterface $entityFactory,</span><br><span class="line">        \Psr\Log\LoggerInterface $logger,</span><br><span class="line">        \Magento\Framework\Data\Collection\Db\FetchStrategyInterface $fetchStrategy,</span><br><span class="line">        \Magento\Framework\Event\ManagerInterface $eventManager,</span><br><span class="line">        $mainTable,</span><br><span class="line">        $eventPrefix,</span><br><span class="line">        $eventObject,</span><br><span class="line">        $resourceModel,</span><br><span class="line">        $model = &#x27;Magento\Framework\View\Element\UiComponent\DataProvider\Document&#x27;,</span><br><span class="line">        $connection = null,</span><br><span class="line">        \Magento\Framework\Model\ResourceModel\Db\AbstractDb $resource = null</span><br><span class="line">    ) &#123;</span><br><span class="line">        parent::__construct($entityFactory, $logger, $fetchStrategy, $eventManager, $connection, $resource);</span><br><span class="line">        $this-&gt;_eventPrefix = $eventPrefix;</span><br><span class="line">        $this-&gt;_eventObject = $eventObject;</span><br><span class="line">        $this-&gt;_init($model, $resourceModel);</span><br><span class="line">        $this-&gt;setMainTable($mainTable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @return \Magento\Framework\Search\AggregationInterface</span><br><span class="line">     */</span><br><span class="line">    public function getAggregations()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;_aggregations;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param \Magento\Framework\Search\AggregationInterface $aggregations</span><br><span class="line">     * @return $this</span><br><span class="line">     */</span><br><span class="line">    public function setAggregations($aggregations)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_aggregations = $aggregations;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Retrieve all ids for collection</span><br><span class="line">     * Backward compatibility with EAV collection</span><br><span class="line">     *</span><br><span class="line">     * @param int $limit</span><br><span class="line">     * @param int $offset</span><br><span class="line">     * @return array</span><br><span class="line">     */</span><br><span class="line">    public function getAllIds($limit = null, $offset = null)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getConnection()-&gt;fetchCol($this-&gt;_getAllIdsSelect($limit, $offset), $this-&gt;_bindParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get search criteria.</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Api\SearchCriteriaInterfacenull</span><br><span class="line">     */</span><br><span class="line">    public function getSearchCriteria()</span><br><span class="line">    &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Set search criteria.</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\Api\SearchCriteriaInterface $searchCriteria</span><br><span class="line">     * @return $this</span><br><span class="line">     * @SuppressWarnings(PHPMD.UnusedFormalParameter)</span><br><span class="line">     */</span><br><span class="line">    public function setSearchCriteria(\Magento\Framework\Api\SearchCriteriaInterface $searchCriteria = null)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get total count.</span><br><span class="line">     *</span><br><span class="line">     * @return int</span><br><span class="line">     */</span><br><span class="line">    public function getTotalCount()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Set total count.</span><br><span class="line">     *</span><br><span class="line">     * @param int $totalCount</span><br><span class="line">     * @return $this</span><br><span class="line">     * @SuppressWarnings(PHPMD.UnusedFormalParameter)</span><br><span class="line">     */</span><br><span class="line">    public function setTotalCount($totalCount)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Set items list.</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\Api\ExtensibleDataInterface[] $items</span><br><span class="line">     * @return $this</span><br><span class="line">     * @SuppressWarnings(PHPMD.UnusedFormalParameter)</span><br><span class="line">     */</span><br><span class="line">    public function setItems(array $items = null)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这部分参考的是 <code>Magento\Cms\Model\ResourceModel\Page\Grid\Collection.php</code> 还可以参考 Magento_Customer, Magento_Sales, Magento_CMS 这些模块。</p>
<h2 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a><a href="#%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"></a>验证结果</h2><p>刷新缓存后，后台访问 <code>Posts</code> 链接 <img src="/wp-content/uploads/2017/09/posts.png" alt="posts"></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/create-admin-grid-magento-2.html">How to Create Admin Grid in Magento 2</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/magento-2-and-konockoutjs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/magento-2-and-konockoutjs/" class="post-title-link" itemprop="url">Magento 2 and konockoutjs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-23 16:46:28" itemprop="dateCreated datePublished" datetime="2017-09-23T16:46:28+08:00">2017-09-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本篇将通过实验来介绍 ko 的模版绑定、自定义绑定和组件绑定，然后在此基础上介绍 magento 2 对 ko 的扩展。最后通过一个例子来介绍如何在 magento 2 中使用 ko 绑定。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a><a href="#%E5%87%86%E5%A4%87"></a>准备</h2><p>在 <code>ThankIT_HelloWorld</code> 模块的基础上，我们来创建一个页面，用来做实验。 File: app\code\ThankIT\HelloWorld\Controller\Knockoutjs\Index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Knockoutjs;</span><br><span class="line"></span><br><span class="line">class Index extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\App\Action\Context  $context</span><br><span class="line">     * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute view action</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Controller\ResultInterface</span><br><span class="line">     */</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File:app\code\ThankIT\HelloWorld\view\frontend\layout\helloworld_knockoutjs_index.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;page layout=&quot;1column&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;referenceContainer name=&quot;content&quot;&gt;</span><br><span class="line">            &lt;block class=&quot;ThankIT\HelloWorld\Block\Knockoutjs\Index&quot; name=&quot;knockoutjs.index&quot; template=&quot;ThankIT_HelloWorld::knockoutjs/index.phtml&quot;/&gt;</span><br><span class="line">        &lt;/referenceContainer&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>File:app\code\ThankIT\HelloWorld\Block\Knockoutjs\Index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Block\Knockoutjs;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\View\Element\Template;</span><br><span class="line"></span><br><span class="line">class Index extends Template</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File:app\code\ThankIT\HelloWorld\view\frontend\templates\knockoutjs\index.phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;First name: &lt;strong data-bind=&quot;text:firstName&quot;&gt;todo&lt;/strong&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;Last name: &lt;strong data-bind=&quot;text:lastName&quot;&gt;todo&lt;/strong&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p><em>注意：Magento 2 的 js 框架部分变化比较频繁，2.0 和 2.1 之间有较大差异，本文使用的是 2.1.7</em> 然后我们清空缓存，刷新页面，打开调试面板，会看到： <img src="/wp-content/uploads/2017/09/ko-uncaught-reference-error.png" alt="ko"> 假设我们在普通的页面中，我们尚未应用 <code>ko.applyBindings(obj)</code>，那么 <code>data-bind</code> 应该被浏览器忽略，我们是不会看到这样的错误的。 所以 Magento 2 页面中自动调用了 <code>ko.applyBindings(obj)</code> 调用 <code>ko.applyBindings()</code> 部分的实现位于 <code>Magento_Ui/js/lib/knockout/bootstrap</code> 具体的文件位置位于 <code>vendor\magento\module-ui\view\base\web\js\lib\knockout\bootstrap.js</code>，文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Copyright © 2013-2017 Magento, Inc. All rights reserved.</span><br><span class="line"> * See COPYING.txt for license details.</span><br><span class="line"> */</span><br><span class="line">/** Loads all available knockout bindings, sets custom template engine, initializes knockout on page */</span><br><span class="line"></span><br><span class="line">define([</span><br><span class="line">    &#x27;ko&#x27;,</span><br><span class="line">    &#x27;./template/engine&#x27;,</span><br><span class="line">    &#x27;knockoutjs/knockout-es5&#x27;,</span><br><span class="line">    &#x27;./bindings/bootstrap&#x27;,</span><br><span class="line">    &#x27;./extender/observable_array&#x27;,</span><br><span class="line">    &#x27;./extender/bound-nodes&#x27;,</span><br><span class="line">    &#x27;domReady!&#x27;</span><br><span class="line">], function (ko, templateEngine) &#123;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">    ko.uid = 0;</span><br><span class="line"></span><br><span class="line">    ko.setTemplateEngine(templateEngine);</span><br><span class="line">    ko.applyBindings();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>至于他是怎样实现页面加载后，自动调用 <code>ko.applyBindings()</code> 的，此处先挖坑，留着以后填。 这里先明白，Magento 2 对 ko 做了自定义，他会让 ko 自动进行初始化。</p>
<h2 id="template-binding"><a href="#template-binding" class="headerlink" title="template binding"></a><a href="#template-binding"></a>template binding</h2><p>我们先来看一个 ko 的模版绑定，看看 ko 原来的用法是怎样的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ko&lt;/title&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Participants&lt;/h2&gt;</span><br><span class="line">Here are the participants:</span><br><span class="line">&lt;div data-bind=&quot;template: &#123; name: &#x27;person-template&#x27;, data: buyer &#125;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div data-bind=&quot;template: &#123; name: &#x27;person-template&#x27;, data: seller &#125;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/html&quot; id=&quot;person-template&quot;&gt;</span><br><span class="line">    &lt;h3 data-bind=&quot;text: name&quot;&gt;&lt;/h3&gt;</span><br><span class="line">    &lt;p&gt;Credits: &lt;span data-bind=&quot;text: credits&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">     function MyViewModel() &#123;</span><br><span class="line">         this.buyer = &#123; name: &#x27;Franklin&#x27;, credits: 250 &#125;;</span><br><span class="line">         this.seller = &#123; name: &#x27;Mario&#x27;, credits: 5800 &#125;;</span><br><span class="line">     &#125;</span><br><span class="line">     ko.applyBindings(new MyViewModel());</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>效果： <img src="/wp-content/uploads/2017/09/template-binding.png" alt="ko 模版绑定"> 下面我们来看看 Magento 2 对 ko 模版引擎的改造后的用法。 将 phtml 改成以下内容： File:app\code\ThankIT\HelloWorld\view\frontend\templates\knockoutjs\index.phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-bind=&quot;template:&#x27;ThankIT_HelloWorld/hello&#x27;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>然后我们创建以下文件： File:app\code\ThankIT\HelloWorld\view\frontend\web\template\hello.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p data-bind=&quot;style:&#123;color:&#x27;red&#x27;&#125;&quot;&gt;Hello World&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>然后我们刷新页面，效果如下： <img src="/wp-content/uploads/2017/09/magento2-ko-template-engine.png" alt="m2 模版引擎"> Magento 2 对 ko 模版引擎的改造让我们不需要用 <code>&lt;script type=&quot;text/html&quot;&gt;</code> 来声明模版，把模版也从 <code>phtml</code> 文件中分离到独立的 <code>html</code> 文件中，有利于模版的复用。</p>
<h2 id="ko-自定义绑定"><a href="#ko-自定义绑定" class="headerlink" title="ko 自定义绑定"></a><a href="#ko-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%91%E5%AE%9A"></a>ko 自定义绑定</h2><p>我们先来看看 ko 的自定义绑定是怎样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ko&lt;/title&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;label&gt;&lt;input type=&quot;checkbox&quot; data-bind=&quot;checked: giftWrap&quot; /&gt; Gift wrap&lt;/label&gt;</span><br><span class="line">&lt;div data-bind=&quot;slideVisible: giftWrap, slideDuration:600, test:&#x27;just for test&#x27;&quot;&gt;You have selected the option&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var viewModel = &#123;</span><br><span class="line">        giftWrap: ko.observable(true)</span><br><span class="line">    &#125;;</span><br><span class="line">    ko.bindingHandlers.slideVisible = &#123;</span><br><span class="line">    update: function(element, valueAccessor, allBindings) &#123;</span><br><span class="line">        // console.log(element);</span><br><span class="line">        // First get the latest data that we&#x27;re bound to</span><br><span class="line">        var value = valueAccessor();</span><br><span class="line">        // console.log(value);</span><br><span class="line">        // Next, whether or not the supplied model property is observable, get its current value</span><br><span class="line">        var valueUnwrapped = ko.unwrap(value);</span><br><span class="line">        // console.log(valueUnwrapped);</span><br><span class="line">        // console.log(allBindings);</span><br><span class="line">        // Grab some more data from another binding property</span><br><span class="line">        var duration = allBindings.get(&#x27;slideDuration&#x27;)  400; // 400ms is default duration unless otherwise specified</span><br><span class="line">        console.log(allBindings.get(&#x27;test&#x27;));</span><br><span class="line">        // Now manipulate the DOM element</span><br><span class="line">        if (valueUnwrapped == true)</span><br><span class="line">            $(element).slideDown(duration); // Make the element visible</span><br><span class="line">        else</span><br><span class="line">            $(element).slideUp(duration);   // Make the element invisible</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    ko.applyBindings(viewModel);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>可参考官方文档 <a target="_blank" rel="noopener" href="http://knockoutjs.com/documentation/custom-bindings.html">Creating custom bindings</a> 效果如下： <img src="/wp-content/uploads/2017/09/ko-custom-binding.gif" alt="ko 自定义绑定"> 要点是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ko.bindingHandlers.yourBindingName = &#123;</span><br><span class="line">    init: function(element, valueAccessor, allBindings, viewModel, bindingContext) &#123;</span><br><span class="line">        // This will be called when the binding is first applied to an element</span><br><span class="line">        // Set up any initial state, event handlers, etc. here</span><br><span class="line">    &#125;,</span><br><span class="line">    update: function(element, valueAccessor, allBindings, viewModel, bindingContext) &#123;</span><br><span class="line">        // This will be called once when the binding is first applied to an element,</span><br><span class="line">        // and again whenever any observables/computeds that are accessed change</span><br><span class="line">        // Update the DOM element based on the supplied values here.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>一旦注册了自定义绑定，就可以这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-bind=&quot;yourBindingName: someValue&quot;&gt; &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="ko-component-绑定"><a href="#ko-component-绑定" class="headerlink" title="ko component 绑定"></a><a href="#ko-component-%E7%BB%91%E5%AE%9A"></a>ko component 绑定</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ko&lt;/title&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h4&gt;First instance, without parameters&lt;/h4&gt;</span><br><span class="line">&lt;div data-bind=&#x27;component: &quot;message-editor&quot;&#x27;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;h4&gt;Second instance, passing parameters&lt;/h4&gt;</span><br><span class="line">&lt;div data-bind=&#x27;component: &#123;</span><br><span class="line">    name: &quot;message-editor&quot;,</span><br><span class="line">    params: &#123; initialText: &quot;Hello, world!&quot; &#125;</span><br><span class="line">&#125;&#x27;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    ko.components.register(&#x27;message-editor&#x27;, &#123;</span><br><span class="line">        viewModel: function(params) &#123;</span><br><span class="line">        /**</span><br><span class="line">         *   几乎所有语言中  和 &amp;&amp; 都遵循“短路”原理，</span><br><span class="line">         *   如 &amp;&amp; 中第一个表达式为假就不会去处理第二个表达式，而  正好相反。</span><br><span class="line">         *   js 也遵循上述原则。</span><br><span class="line">         *   当  时，找到为 true 的分项就停止处理，并返回该分项的值，否则执行完，并返回最后分项的值。</span><br><span class="line">         *   当 &amp;&amp; 时，找到为 false 的分项就停止处理，并返回该分项的值。</span><br><span class="line">         **/</span><br><span class="line">            this.text = ko.observable(params &amp;&amp; params.initialText  &#x27;&#x27;);</span><br><span class="line">        &#125;,</span><br><span class="line">        template: &#x27;Message: &lt;input data-bind=&quot;value: text&quot; /&gt; &#x27;+ &#x27;(length: &lt;span data-bind=&quot;text: text().length&quot;&gt;&lt;/span&gt;)&#x27;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ko.applyBindings();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>效果如下： <img src="/wp-content/uploads/2017/09/ko-component-binding.gif" alt="ko-component-binding"> 可以参考官方文档 <a target="_blank" rel="noopener" href="http://knockoutjs.com/documentation/component-binding.html">The “component” binding</a> component 组合了 view model 和 template ，我们向组件传递参数来设置 view model ，注意，此处 <code>ko.applyBindings()</code> 并没有传递 <code>obj</code> 。 回到 Magento 2 中，上面讲到 M2 自动调用了 <code>ko.applyBindings()</code> 也没有传递参数，那么 M2 一定是对 ko 做了类似组件的绑定。</p>
<h2 id="magento-2-中使用-ko-绑定"><a href="#magento-2-中使用-ko-绑定" class="headerlink" title="magento 2 中使用 ko 绑定"></a><a href="#magento-2-%E4%B8%AD%E4%BD%BF%E7%94%A8-ko-%E7%BB%91%E5%AE%9A"></a>magento 2 中使用 ko 绑定</h2><p>下面我们来做一个例子 File:app\code\ThankIT\HelloWorld\view\frontend\layout\helloworld_knockoutjs_index.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;page layout=&quot;1column&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;referenceContainer name=&quot;content&quot;&gt;</span><br><span class="line">            &lt;block class=&quot;ThankIT\HelloWorld\Block\Knockoutjs\Index&quot; name=&quot;knockoutjs.index&quot; template=&quot;ThankIT_HelloWorld::knockoutjs/index.phtml&quot;&gt;</span><br><span class="line">                &lt;arguments&gt;</span><br><span class="line">                    &lt;argument name=&quot;jsLayout&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                        &lt;item name=&quot;components&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                            &lt;item name=&quot;customer-list&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                                &lt;item name=&quot;component&quot; xsi:type=&quot;string&quot;&gt;ThankIT_HelloWorld/js/view/customer/list&lt;/item&gt;</span><br><span class="line">                                &lt;item name=&quot;config&quot; xsi:type=&quot;array&quot;&gt;</span><br><span class="line">                                    &lt;item name=&quot;template&quot; xsi:type=&quot;string&quot;&gt;ThankIT_HelloWorld/customer/list&lt;/item&gt;</span><br><span class="line">                                &lt;/item&gt;</span><br><span class="line">                            &lt;/item&gt;</span><br><span class="line">                        &lt;/item&gt;</span><br><span class="line">                    &lt;/argument&gt;</span><br><span class="line">                &lt;/arguments&gt;</span><br><span class="line">            &lt;/block&gt;</span><br><span class="line">        &lt;/referenceContainer&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>通过 <code>arguments</code> 传递参数，如果不清楚 layout 中 <code>arguments</code> 的用法，参考 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/layout-instruction-%E4%B9%8B-argument-%E5%92%8C-action/">Layout instruction 之 argument 和 action</a> 上面我们这里传递进去一个数组，相当于给 block 对象设置了 <code>$this-&gt;jsLayout</code> 的值。 File: app\code\ThankIT\HelloWorld\Block\Knockoutjs\Index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Block\Knockoutjs;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\View\Element\Template;</span><br><span class="line"></span><br><span class="line">class Index extends Template</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\View\Element\Template\Context $context,</span><br><span class="line">        array $layoutProcessors = [],</span><br><span class="line">        array $data = []</span><br><span class="line">    ) &#123;</span><br><span class="line">        parent::__construct($context, $data);</span><br><span class="line">        $this-&gt;layoutProcessors = $layoutProcessors;</span><br><span class="line">    &#125;</span><br><span class="line">    public function getJsLayout()</span><br><span class="line">    &#123;</span><br><span class="line">        foreach ($this-&gt;layoutProcessors as $processor) &#123;</span><br><span class="line">            $this-&gt;jsLayout = $processor-&gt;process($this-&gt;jsLayout);</span><br><span class="line">        &#125;</span><br><span class="line">        return parent::getJsLayout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File:app\code\ThankIT\HelloWorld\view\frontend\templates\knockoutjs\index.phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-bind=&quot;template:&#x27;ThankIT_HelloWorld/hello&#x27;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;customer-page&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;block-customer-list&quot; data-bind=&quot;scope:&#x27;customer-list&#x27;&quot; class=&quot;block&quot;&gt;</span><br><span class="line">    &lt;?php echo $block-&gt;getJsLayout();?&gt;</span><br><span class="line">        &lt;!-- ko template: getTemplate() --&gt;&lt;!-- /ko --&gt;</span><br><span class="line">        &lt;script type=&quot;text/x-magento-init&quot;&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;#block-customer-list&quot;: &#123;</span><br><span class="line">                    &quot;Magento_Ui/js/core/app&quot;: &lt;?php /* @escapeNotVerified */ echo $block-&gt;getJsLayout();?&gt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>这里我们调用了 block 中的 <code>getJsLayout()</code> 方法，返回一个 json ，然后我们将它搁在 <code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 中，可参考<a target="_blank" rel="noopener" href="https://www.hellomagento2.com/magento-2-javascript-init-ways/"><code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code></a> 它将载入 <code>Magento_Ui/js/core/app</code> 模块，并且将 <code>getJsLayout()</code> 方法输出的 json 对象和作用节点 <code>#block-customer-list</code> 传递给它并执行。 <code>getJsLayout()</code> 输出的东西是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;components&quot;:&#123;&quot;customer-list&quot;:&#123;&quot;component&quot;:&quot;ThankIT_HelloWorld\/js\/view\/customer\/list&quot;,&quot;config&quot;:&#123;&quot;template&quot;:&quot;ThankIT_HelloWorld\/customer\/list&quot;&amp;#125;&amp;#125;&amp;#125;&amp;#125;</span><br></pre></td></tr></table></figure>

<p><code>customer-list</code> 正对应着 <code>&lt;div id=&quot;block-customer-list&quot; data-bind=&quot;scope:&#39;customer-list&#39;&quot; class=&quot;block&quot;&gt;</code> <code>data-bind=&quot;scope:&#39;customer-list&#39;&quot;</code> 中的 <code>scope</code> 是 magento 2 创建的自定义绑定。 File：app\code\ThankIT\HelloWorld\view\frontend\web\js\view\customer\list.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">define([&#x27;jquery&#x27;, &#x27;ko&#x27;, &#x27;uiComponent&#x27;], function($, ko, Component) &#123;</span><br><span class="line">    &quot;use strict&quot;;</span><br><span class="line">    var listCustomers = ko.observableArray([]);</span><br><span class="line">    return Component.extend(&#123;</span><br><span class="line">        getListCustomers: function() &#123;</span><br><span class="line">            if (!listCustomers().length) &#123;</span><br><span class="line">                listCustomers([&#123;&quot;entity_id&quot;: 1,&quot;email&quot;:&quot;123@qq.com&quot;,&quot;firstname&quot;:&quot;wendy&quot;,&quot;lastname&quot;:&quot;wu&quot;,&quot;created_at&quot;:&quot;2017&quot;&#125;]);</span><br><span class="line">            &#125;</span><br><span class="line">            return listCustomers;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>File: app\code\ThankIT\HelloWorld\view\frontend\web\template\customer\list.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Email&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Name&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Created At&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/thead&gt;</span><br><span class="line">    &lt;tbody data-bind=&quot;foreach: getListCustomers()&quot;&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td data-bind=&quot;text: entity_id&quot;&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td data-bind=&quot;text: email&quot;&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td data-bind=&quot;text: firstname  + &#x27; &#x27; + lastname&quot;&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td data-bind=&quot;text: created_at&quot;&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<p>下面访问 url <code>http://example.com/helloworld/knockoutjs/index/</code> 结果如下： <img src="/wp-content/uploads/2017/09/magento2-ko.png"></p>
<h2 id="magento-2-是如何做到的？"><a href="#magento-2-是如何做到的？" class="headerlink" title="magento 2 是如何做到的？"></a><a href="#magento-2-%E6%98%AF%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E7%9A%84%EF%BC%9F"></a>magento 2 是如何做到的？</h2><p><a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/120447/how-does-magento-2-apply-knockoutjs-bindings">How Does Magento 2 Apply KnockoutJS Bindings</a> <a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/120221/magento-2-how-where-is-the-gettemplate-knockout-function-bound/120508#120508">Magento 2: How&#x2F;Where is the <code>getTemplate</code> Knockout Function Bound?</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/json/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/json/" class="post-title-link" itemprop="url">JSON</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-21 13:49:43" itemprop="dateCreated datePublished" datetime="2017-09-21T13:49:43+08:00">2017-09-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>JSON (JavaScript Object Notation ，JavaScript 对象表示法)，是一种轻量级的数据交换格式，比 xml 更易于解析，更明了。本篇将介绍 JSON 在 JavaScript 和 php 中的使用。 JSON 使用 JavaScript 语法来描述数据对象，但是 JSON 仍然独立于语言和平台。JSON 解析器和 JSON 库支持许多不同的编程语言。 JSON 主要保存两种结构：对象和数组。</p>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a><a href="#%E5%AF%B9%E8%B1%A1"></a>对象</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;firstName&quot;:&quot;John&quot; , &quot;lastName&quot;:&quot;Doe&quot; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a><a href="#%E6%95%B0%E7%BB%84"></a>数组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123; &quot;firstName&quot;:&quot;Bill&quot; , &quot;lastName&quot;:&quot;Gates&quot; &#125;,</span><br><span class="line">&#123; &quot;firstName&quot;:&quot;George&quot; , &quot;lastName&quot;:&quot;Bush&quot; &#125;,</span><br><span class="line">&#123; &quot;firstName&quot;:&quot;Thomas&quot; , &quot;lastName&quot;: &quot;Carter&quot; &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"></a>注意点</h2><p><em>JSON 的键必须使用双引号，值如果是字符串，也必须使用双引号。</em> 数据传输过程中，JSON 是以文本即字符串的形式传输的。所以存在一个 JSON 字符串和 JSON 对象&#x2F;值转换的问题。</p>
<h2 id="用在-JavaScript-中"><a href="#用在-JavaScript-中" class="headerlink" title="用在 JavaScript 中"></a><a href="#%E7%94%A8%E5%9C%A8-javascript-%E4%B8%AD"></a>用在 JavaScript 中</h2><h3 id="eval"><a href="#eval" class="headerlink" title="eval()"></a><a href="#eval()"></a>eval()</h3><p><code>eval()</code> 函数可计算某个字符串，并执行其中的的 JavaScript 代码。 由于 JSON 语法是 JavaScript 语法的子集，JavaScript 函数 <code>eval()</code> 可用于将 JSON 文本转换为 JavaScript 对象。 <code>eval()</code> 函数使用的是 JavaScript 编译器，可解析 JSON 文本，然后生成 JavaScript 对象。必须把文本包围在括号中，这样才能避免语法错误。 例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    // case 1</span><br><span class="line">    var string = &#x27;&#123; &quot;firstName&quot;:&quot;John&quot; , &quot;lastName&quot;:&quot;Doe&quot; &#125;&#x27;;</span><br><span class="line">    var obj = eval(&#x27;(&#x27; + string + &#x27;)&#x27;);</span><br><span class="line">    alert(obj.firstName);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>eval() 函数可编译并执行任何 JavaScript 代码。这隐藏着潜在的安全问题。</p>
<h3 id="JSON-解析器"><a href="#JSON-解析器" class="headerlink" title="JSON 解析器"></a><a href="#json-%E8%A7%A3%E6%9E%90%E5%99%A8"></a>JSON 解析器</h3><p>JSON 解析器只能识别 JSON 文本，而不会编译脚本，JSON 解析器速度更快，也更安全。 但是 JSON 解析器并不是一开始就由浏览器实现了，他存在兼容性问题。兼容性情况请参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse()</a> 例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    // case 2</span><br><span class="line">    var string = &#x27;&#123; &quot;firstName&quot;:&quot;John&quot; , &quot;lastName&quot;:&quot;Doe&quot; &#125;&#x27;;</span><br><span class="line">    var obj = JSON.parse(string);</span><br><span class="line">    alert(obj.firstName);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><em>JSON.parse() 不允许用逗号作为结尾</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// both will throw a SyntaxError</span><br><span class="line">JSON.parse(&quot;[1, 2, 3, 4, ]&quot;);</span><br><span class="line">JSON.parse(&#x27;&#123;&quot;foo&quot; : 1, &#125;&#x27;);</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    // case 3</span><br><span class="line">    var obj = &#123; &quot;firstName&quot;:&quot;John&quot; , &quot;lastName&quot;:&quot;Doe&quot; &#125;;</span><br><span class="line">    var string = JSON.stringify(obj);</span><br><span class="line">    console.log(string);</span><br><span class="line">    console.log(obj);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>JSON.stringify</code> 将 JS 对象转换成字符串。</p>
<h3 id="使用其他-js-包"><a href="#使用其他-js-包" class="headerlink" title="使用其他 js 包"></a><a href="#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96-js-%E5%8C%85"></a>使用其他 js 包</h3><p>可查阅官方文档 <a target="_blank" rel="noopener" href="http://www.json.org/">Introducing JSON</a></p>
<h2 id="用在-php-中"><a href="#用在-php-中" class="headerlink" title="用在 php 中"></a><a href="#%E7%94%A8%E5%9C%A8-php-%E4%B8%AD"></a>用在 php 中</h2><p>php 从 5.2 开始提供对 JSON 的原生支持。</p>
<h3 id="json-encode"><a href="#json-encode" class="headerlink" title="json_encode()"></a><a href="#%60json_encode()%60"></a><code>json_encode()</code></h3><p><code>json_encode()</code> 用于将数组和对象转换成 json 字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$arr1 = [&#x27;1&#x27; =&gt; &#x27;one&#x27;, &#x27;2&#x27; =&gt; &#x27;two&#x27;, &#x27;3&#x27; =&gt; &#x27;three&#x27;];</span><br><span class="line">echo json_encode($arr1);</span><br><span class="line"></span><br><span class="line">echo &#x27;&lt;br/&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">$arr2 = [&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;];</span><br><span class="line">echo json_encode($arr2);</span><br><span class="line"></span><br><span class="line">echo &#x27;&lt;br/&gt;&#x27;;</span><br><span class="line">echo json_encode($arr2, JSON_FORCE_OBJECT);</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;1&quot;:&quot;one&quot;,&quot;2&quot;:&quot;two&quot;,&quot;3&quot;:&quot;three&quot;&#125;</span><br><span class="line">[&quot;one&quot;,&quot;two&quot;,&quot;three&quot;]</span><br><span class="line">&#123;&quot;0&quot;:&quot;one&quot;,&quot;1&quot;:&quot;two&quot;,&quot;2&quot;:&quot;three&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><em>由于 javascript 中是通过对象来实现关联数组的，所以 json_encode() 只将索引数组转为数组格式，而将关联数组转为对象格式。</em> 对象的转换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public function hello()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;hello,my name is&#x27; . $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$jone = new Person();</span><br><span class="line">$jone-&gt;name = &#x27;jone&#x27;;</span><br><span class="line"></span><br><span class="line">// echo gettype(json_encode($jone));</span><br><span class="line">echo json_encode($jone);</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;jone&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>除了公开变量（public），其他东西（常量、私有变量、方法等等）都会遗失。</p>
<h3 id="json-decode"><a href="#json-decode" class="headerlink" title="json_decode()"></a><a href="#%60json_decode()%60"></a><code>json_decode()</code></h3><p><code>json_decode()</code> 用于将 JSON 字符串转换成相应的 php 数据结构。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$string = &#x27;&#123;&quot;name&quot;:&quot;jone&quot;&#125;&#x27;;</span><br><span class="line">$obj = json_decode($string);</span><br><span class="line">var_dump($obj);</span><br><span class="line"></span><br><span class="line">// 强制生成关联数组</span><br><span class="line">var_dump(json_decode($string, true));</span><br><span class="line"></span><br><span class="line">$string2 = &#x27;[&quot;one&quot;,&quot;two&quot;,&quot;three&quot;]&#x27;;</span><br><span class="line">var_dump(json_decode($string2));</span><br></pre></td></tr></table></figure>

<p>输出： <img src="/wp-content/uploads/2017/09/json_decode.png" alt="json decode"> 通常情况下，<code>json_decode()</code> 总是返回一个PHP对象，而不是数组。如果想要强制生成PHP关联数组，<code>json_decode()</code>需要加一个参数 <code>true</code></p>
<h3 id="注意点-1"><a href="#注意点-1" class="headerlink" title="注意点"></a><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"></a>注意点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$string = &#x27;&#123;&quot;name&quot;:&quot;jone&quot;,&#125;&#x27;;</span><br><span class="line">var_dump(json_decode($string));</span><br></pre></td></tr></table></figure>

<p>将会返回 null <em>和 <code>JSON.parse()</code>一样，<code>json_decode()</code> 不允许用逗号作为结尾</em></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="http://www.json.org/">Introducing JSON</a> <a target="_blank" rel="noopener" href="http://www.w3school.com.cn/json/json_eval.asp">JSON 使用</a> <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2011/01/json_in_php.html">在PHP语言中使用JSON</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/magento-2-javascript-init-ways/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/magento-2-javascript-init-ways/" class="post-title-link" itemprop="url"><script type=\"text/x-magento-init\"></a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-19 09:02:28" itemprop="dateCreated datePublished" datetime="2017-09-19T09:02:28+08:00">2017-09-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我们在 magento 2 的 phtml 中经常会看到 <code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 和 <code>data-mage-init</code> ，那么这两个标签是用来做什么的？本篇将给出解释，并说明这样设计的用意。</p>
<h2 id="Magento-2-的自定义设计"><a href="#Magento-2-的自定义设计" class="headerlink" title="Magento 2 的自定义设计"></a><a href="#magento-2-%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E8%AE%A1"></a>Magento 2 的自定义设计</h2><p><em>首先 <code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 是 Magento 2 的自定义设计。</em> 我们新建一个 html 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    alert(&#x27;common&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/x-magento-init&quot;&gt;</span><br><span class="line">    alert(&#x27;magento&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>然后从浏览器中访问他，我们会看到 <code>common</code> 的 alert 但不会看到 <code>magento</code> 的 alert 。这是因为浏览器不认识 <code>type=&quot;text/x-magento-init&quot;</code> 的这个 <code>&lt;script&gt;</code>，所以会直接忽略它。</p>
<h2 id="创建一个演示模块"><a href="#创建一个演示模块" class="headerlink" title="创建一个演示模块"></a><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%BC%94%E7%A4%BA%E6%A8%A1%E5%9D%97"></a>创建一个演示模块</h2><p>我们还是以 <code>ThankIT_HelloWorld</code> 为基础。</p>
<h3 id="创建-Controller"><a href="#创建-Controller" class="headerlink" title="创建 Controller"></a><a href="#%E5%88%9B%E5%BB%BA-controller"></a>创建 Controller</h3><p>File:app\code\ThankIT\HelloWorld\Controller\Javascript\Example.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Javascript;</span><br><span class="line"></span><br><span class="line">class Example extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\App\Action\Context  $context</span><br><span class="line">     * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute view action</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Controller\ResultInterface</span><br><span class="line">     */</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-layout"><a href="#创建-layout" class="headerlink" title="创建 layout"></a><a href="#%E5%88%9B%E5%BB%BA-layout"></a>创建 layout</h3><p>File:app\code\ThankIT\HelloWorld\view\frontend\layout\helloworld_javascript_example.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;page layout=&quot;1column&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;referenceContainer name=&quot;content&quot;&gt;</span><br><span class="line">            &lt;block class=&quot;ThankIT\HelloWorld\Block\Javascript\Example&quot; name=&quot;Javascript.Example&quot; template=&quot;ThankIT_HelloWorld::javascript/example.phtml&quot;/&gt;</span><br><span class="line">        &lt;/referenceContainer&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建-Block"><a href="#创建-Block" class="headerlink" title="创建 Block"></a><a href="#%E5%88%9B%E5%BB%BA-block"></a>创建 Block</h3><p>File:app\code\ThankIT\HelloWorld\Block\Javascript\Example.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Javascript;</span><br><span class="line"></span><br><span class="line">class Example extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\App\Action\Context  $context</span><br><span class="line">     * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute view action</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Controller\ResultInterface</span><br><span class="line">     */</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-template"><a href="#创建-template" class="headerlink" title="创建 template"></a><a href="#%E5%88%9B%E5%BB%BA-template"></a>创建 template</h3><p>File:app\code\ThankIT\HelloWorld\view\frontend\templates\javascript\example.phtml 内容为空 然后刷新缓存，访问 url <code>http://example/helloworld/javascript/example</code> 我们就会看到带 header 和 footer 的页面，内容为空。 这里没有什么稀奇的，只是一个准备工作，预热一下。</p>
<h2 id="创建一个-requirejs-模块"><a href="#创建一个-requirejs-模块" class="headerlink" title="创建一个 requirejs 模块"></a><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-requirejs-%E6%A8%A1%E5%9D%97"></a>创建一个 requirejs 模块</h2><p>我们先关闭掉 fpc (Full page caching)，这样不用每次清缓存看结果。 我们先在 <code>File:app\code\ThankIT\HelloWorld\view\frontend\templates\javascript\example.phtml</code> 中填入以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    console.log(&#x27;hello&#x27;);</span><br><span class="line">    jQuery(function($)&#123;</span><br><span class="line">        alert(&quot;Hello World&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>然后我们刷新页面，查看控制台，会发现： <img src="/wp-content/uploads/2017/09/jquery-is-not-defined.png" alt="jQuery is not defined"> 这是因为 Magento 2 使用 RequireJS 做基础，对 JS 进行模块化，默认不会使用全局命名空间，<code>jQuery</code> 也不再暴露到全局空间。我们应该使用 <code>RequireJS</code> 的方式来访问 js 模块。 Magento 2 本身就是集成了 <code>jQuery</code> 的，所以我们可以这样访问：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    requirejs([&#x27;jquery&#x27;], function($) &#123;</span><br><span class="line">        alert(&quot;Hello World&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>关于 <code>RequireJS</code> 可以参阅 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/alan-magento-2-and-requirejs/">Magento 2 and RequireJS (翻译)</a> 我们现在创建以下文件： File: app\code\ThankIT\HelloWorld\view\frontend\web\example.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define([], function()&#123;</span><br><span class="line">    alert(&quot;A simple RequireJS module&quot;);</span><br><span class="line">    var mageJsComponent = function()</span><br><span class="line">    &#123;</span><br><span class="line">        alert(&quot;A simple magento component.&quot;);</span><br><span class="line">    &#125;;</span><br><span class="line">    return mageJsComponent;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样我们就定义了一个简单的 RequireJS module，这个模块的位置是 <code>app\code\ThankIT\HelloWorld\view\frontend\web\example.js</code>，那么他的模块名，在没有重新命名的情况下，就是 <code>ThankIT_HelloWorld/example</code>。 然后我们来更改 phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    requirejs([&#x27;ThankIT_HelloWorld/example&#x27;], function($) &#123;</span><br><span class="line">        alert(&quot;Hello World&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>刷新网页，然后我们会先看到弹出框 A simple RequireJS module，然后是 Hello World。就是我们先加载 <code>ThankIT_HelloWorld/example</code> 然后执行 <code>alert(&quot;Hello World&quot;);</code> 好，这样看来，我们已经会给 Magento 2 加 js module ，并且在 phtml 中使用它了。 要了解更详细的解释，请参阅 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/alan-magento-2-javascript-init-scripts/">Magento 2 Javascript Init Scripts（翻译）</a></p>
<h2 id="lt-script-type-quot-text-x-magento-init-quot-gt"><a href="#lt-script-type-quot-text-x-magento-init-quot-gt" class="headerlink" title="&lt;script type=&quot;text/x-magento-init&quot;&gt;"></a><a href="#%60%60"></a><code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code></h2><p>让我们来修改 phtml 为以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/x-magento-init&quot;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;*&quot;: &#123;</span><br><span class="line">            &quot;ThankIT_HelloWorld/example&quot;:&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>example</code> 的内容不变：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define([], function()&#123;</span><br><span class="line">    alert(&quot;A simple RequireJS module&quot;);</span><br><span class="line">    var mageJsComponent = function()</span><br><span class="line">    &#123;</span><br><span class="line">        alert(&quot;A simple magento component.&quot;);</span><br><span class="line">    &#125;;</span><br><span class="line">    return mageJsComponent;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这时候刷新页面（有时也需要情况浏览器缓存），我们会发现，这次先弹出 <code>A simple RequireJS module</code> 然后弹出 <code>A simple magento component.</code> 上面我们用 <code>requirejs</code> 的方法，并没有弹出 <code>A simple magento component.</code> 也就是说，<code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 方式不仅会使用 <code>requirejs</code> 的方式加载该模块，而且还湖调用它。</p>
<h2 id="传参"><a href="#传参" class="headerlink" title="传参"></a><a href="#%E4%BC%A0%E5%8F%82"></a>传参</h2><p>phtml 改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;text&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/x-magento-init&quot;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;#text&quot;: &#123;</span><br><span class="line">            &quot;ThankIT_HelloWorld/example&quot;:&#123;&quot;config&quot;:&#123;&quot;text&quot;:&quot;Hello Magento 2, Hello ThankIT ...&quot;&amp;#125;&amp;#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>example</code> 改成:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define([&#x27;jquery&#x27;], function($)&#123;</span><br><span class="line">    var setText = function(config, node) &#123;</span><br><span class="line">        console.log(config);</span><br><span class="line">        console.log(node);</span><br><span class="line">        $(node).html(config.config.text);</span><br><span class="line">    &#125;</span><br><span class="line">    return setText;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>清空浏览器缓存，刷新页面，这时候，我们的页面会是这样的： <img src="/wp-content/uploads/2017/09/node-config-results.png" alt="magento 2 x-magento-init"> <img src="/wp-content/uploads/2017/09/console.log_.results.png" alt="magento 2 x-magento-init console log"> 不过这里<code>console.log</code> 出的结果有点奇怪，按照我的理解，输出的 node 不应该含有 <code>Hello Magento 2, Hello ThankIT ...</code> 内容。。。有清楚的朋友请给我留个言吧，感谢！ <em>通过上面这个例子，我们知道 ** <code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 方式可以传递要作用的节点，可以传递配置参数，并且之后被调用执行。**通过这样的设计，Magento 鼓励开发者避免在 RequireJS 模块中硬编码 DOM 节点。传递的配置参数可以由服务器端生成。这进一步分离的会让代码更清晰。</em></p>
<h2 id="data-mage-init"><a href="#data-mage-init" class="headerlink" title="data-mage-init"></a><a href="#data-mage-init"></a>data-mage-init</h2><p>这个方式实际上和 <code>&lt;script type=&quot;text/x-magento-init&quot;&gt;</code> 是一样的。 我们把 phtml 改成下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-mage-init=&#x27;&#123;&quot;ThankIT_HelloWorld/example&quot;: &#123;&quot;config&quot;:&#123;&quot;text&quot;:&quot;Hello Magento 2, Hello ThankIT ... use data-mage-init ...&quot;&amp;#125;&amp;#125;&#125;&#x27;&gt;A single div&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>刷新页面，是不是先看到 <code>A single div</code> ，随后被替换成了 <code>Hello Magento 2, Hello ThankIT ... use data-mage-init ...</code> <em>注意，我们的属性中使用的是单引号</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-mage-init=&#x27;...&#x27;&gt;A single div&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>这是必要的，<code>data-mage-init</code> 属性会严格按照 JSON 格式解析，就是说 JSON 对象必须使用双引号，所以我们的属性就只能用单引号了。</p>
<h2 id="关于如何实现的-type-x3D-”text-x2F-x-magento-init”"><a href="#关于如何实现的-type-x3D-”text-x2F-x-magento-init”" class="headerlink" title="关于如何实现的 type&#x3D;”text&#x2F;x-magento-init”"></a><a href="#%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84-type="></a>关于如何实现的 type&#x3D;”text&#x2F;x-magento-init”</h2><p>The code that uses them is located in <code>lib/web/mage/apply/scripts.js</code> 参考 <a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/89187/in-magento2-what-is-script-type-text-x-magento-init">In Magento2 what is<code>&lt;script type=“text/x-magento-init”&gt;</code>?</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.hellomagento2.com/alan-magento-2-and-requirejs/">Magento 2 and RequireJS (翻译)</a> <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/alan-magento-2-javascript-init-scripts/">Magento 2 Javascript Init Scripts（翻译）</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/magento-layout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/magento-layout/" class="post-title-link" itemprop="url">Magento Layout</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-17 12:21:11" itemprop="dateCreated datePublished" datetime="2017-09-17T12:21:11+08:00">2017-09-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Magento-%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Magento 开发教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>假设读者朋友们已经会自己创建简单的模块，并且使用过 layout xml 来展示某个页面了。那么本篇将对 magento layout 做一个总结，从概念上理顺 magento layout 是什么，它是为了解决什么问题，并串联与之相关的一些知识。 如果你还不会创建模块，请参阅 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/%E5%88%9B%E5%BB%BA-magento-2-hello-world-simple-module/">创建 Magento 2 Hello World Simple Module</a> 如果还没有使用过 layout ，请参阅 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/magento-2-%E4%B8%AD%E7%9A%84-controller/">Magento 2 中的 Controller</a></p>
<h2 id="magento-layout-是什么"><a href="#magento-layout-是什么" class="headerlink" title="magento layout 是什么"></a><a href="#magento-layout-%E6%98%AF%E4%BB%80%E4%B9%88"></a>magento layout 是什么</h2><p><em>A Layout is a collection of blocks in a tree structure</em> Layout 是 block 的集合，这些 block 是树形结构组织的。 那么 magento block 是什么？ <em>A Magento block is an object with a toHtml method defined. When this toHtml method is called, it returns the string which should be output to the screen.</em> 可以认为，Magento block 是对象，这个对象拥有方法 <code>toHtml()</code> ，调用这个方法会返回 html 片段的字符串。 早期的 php 开发是 html 和 php 代码混淆在一起的，但是这样很难维护和分工，所以将 html 分离出来，成为模版层。 我们知道 block 都会对应一个 phtml 模版。当 block 的 <code>toHtml()</code> 被调用时，phtml 文件会被 <code>include</code> （就是 php 内置的 <code>include</code>）进去。（详情请参考 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/magento-2-templates-use-block-or-this/">Magento 2 Templates: Use $block or $this</a> 中 <code>Magento\Framework\View\TemplateEngine\Php</code> 的 <code>render</code> 方法。） phtml 是可以 override 的，参考 <a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.1/frontend-dev-guide/themes/theme-inherit.html">Theme inheritance</a> layout 可以 extend 也可以 override 。参考 <a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.1/frontend-dev-guide/layouts/layout-extend.html">Extend a layout</a> 和 <a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.1/frontend-dev-guide/layouts/layout-override.html">Override a layout</a></p>
<h2 id="嵌套结构"><a href="#嵌套结构" class="headerlink" title="嵌套结构"></a><a href="#%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%84"></a>嵌套结构</h2><p>layout xml 的内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;page xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;referenceContainer name=&quot;customer.login.container&quot;&gt;</span><br><span class="line">        &lt;block class=&quot;ThankIT\SocialLogin\Block\SocialBlock&quot; name=&quot;thankit_social_block&quot; ifconfig=&quot;thankit_sociallogin/general/enable&quot; template=&quot;ThankIT_SocialLogin::login/socialblock.phtml&quot; cacheable=&quot;false&quot; after=&quot;customer.new&quot;&gt;</span><br><span class="line">            &lt;block class=&quot;ThankIT\SocialLogin\Block\Buttons&quot; name=&quot;thankit_login_buttons&quot; template=&quot;ThankIT_SocialLogin::login/buttons.phtml&quot; /&gt;</span><br><span class="line">        &lt;/block&gt;</span><br><span class="line">    &lt;/referenceContainer&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>可以看出我们的 block 中嵌套了一个 block ，那么最外面的 block 对应的 <code>ThankIT_SocialLogin::login/socialblock.phtml</code> 模版内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$helper = $this-&gt;helper(&#x27;ThankIT\SocialLogin\Helper\Data&#x27;);</span><br><span class="line">if($helper-&gt;hasButtons()) : ?&gt;</span><br><span class="line">    // ... 省略内容</span><br><span class="line">    &lt;?php echo $block-&gt;getChildHtml(&#x27;thankit_login_buttons&#x27;); ?&gt;</span><br><span class="line">&lt;?php endif; ?&gt;</span><br></pre></td></tr></table></figure>

<p>注意此处<code>$block-&gt;getChildHtml(&#39;thankit_login_buttons&#39;);</code> 我们调用了 block 的 <code>getChildHtml</code> 方法，该方法来自 class <code>Magento\Framework\View\Element\AbstractBlock</code> ，他将取他的 child block ，并调用其 <code>toHtml</code> 方法。 所以我们的 block 可以有序组织起来，形成嵌套的结构。 <code>getChildHtml()</code> 如果不给参数，则 render all child blocks 。</p>
<h2 id="controller-中直接创建-block"><a href="#controller-中直接创建-block" class="headerlink" title="controller 中直接创建 block"></a><a href="#controller-%E4%B8%AD%E7%9B%B4%E6%8E%A5%E5%88%9B%E5%BB%BA-block"></a>controller 中直接创建 block</h2><p>我们在 <code>ThankIT_HelloWorld</code> 模块的基础上，创建以下 controller</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Create;</span><br><span class="line"></span><br><span class="line">class Block extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\App\Action\Context  $context</span><br><span class="line">     * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute view action</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Controller\ResultInterface</span><br><span class="line">     */</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        $resultPage = $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">        // var_dump(get_class($resultPage-&gt;getConfig()-&gt;getTitle()));</span><br><span class="line">        $resultPage-&gt;getConfig()-&gt;getTitle()-&gt;set(__(&#x27;create block directly and fpc&#x27;));</span><br><span class="line"></span><br><span class="line">        $block = $resultPage-&gt;getLayout()</span><br><span class="line">            -&gt;createBlock(&#x27;ThankIT\HelloWorld\Block\Index\Index&#x27;)</span><br><span class="line">            -&gt;setTemplate(&#x27;ThankIT_HelloWorld::index/index.phtml&#x27;)</span><br><span class="line">            -&gt;toHtml();</span><br><span class="line">        $this-&gt;getResponse()-&gt;setBody($block);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么我们会得到一些字符串，连 html 结构都没有。此处仅仅为了说明是如何调用 <code>toHtml</code> 来得到 html 片段的。 关于 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/magento-2-controller-and-fpc/">Magento 2 Controller and FPC</a></p>
<h2 id="layout-xml-要解决的问题"><a href="#layout-xml-要解决的问题" class="headerlink" title="layout xml 要解决的问题"></a><a href="#layout-xml-%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"></a>layout xml 要解决的问题</h2><p>layout xml 要解决的是让主题开发人员也可以控制 HTML 的输出。其实就是又一层抽象，让主题开发人员不需要去改 php 。 博主个人认为，layout xml 带来的好处是他的分散性，可以很方便的进行扩展、更改、维护。如果我们要在 controller 中控制 block 的输出，那么我们都要去改 controller ，这就很难维护了。</p>
<h2 id="Magento-2-layout-文件类型"><a href="#Magento-2-layout-文件类型" class="headerlink" title="Magento 2 layout 文件类型"></a><a href="#magento-2-layout-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"></a>Magento 2 layout 文件类型</h2><p>参考 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/magento-2-layout-types/">Magento 2 layout 文件类型</a></p>
<h2 id="Magento-2-layout-使用"><a href="#Magento-2-layout-使用" class="headerlink" title="Magento 2 layout 使用"></a><a href="#magento-2-layout-%E4%BD%BF%E7%94%A8"></a>Magento 2 layout 使用</h2><p>关于指令： <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/layout-instruction-%E4%B9%8B-argument-%E5%92%8C-action">Layout instruction 之 argument 和 action</a> 后台的使用 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/layout-update-place-block/">Using a Layout Update</a></p>
<h2 id="获得-layout-的工具"><a href="#获得-layout-的工具" class="headerlink" title="获得 layout 的工具"></a><a href="#%E8%8E%B7%E5%BE%97-layout-%E7%9A%84%E5%B7%A5%E5%85%B7"></a>获得 layout 的工具</h2><p><a target="_blank" rel="noopener" href="https://www.hellomagento2.com/debug-tool-how-to-get-all-xml-layout/">调试工具：如何得到页面的布局文件</a> 可进一步挖掘，获得想要的 layout 文件。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p>《No Frills Magento Layout》 by Alan Storm 2011</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/layout-instruction-%E4%B9%8B-argument-%E5%92%8C-action/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/layout-instruction-%E4%B9%8B-argument-%E5%92%8C-action/" class="post-title-link" itemprop="url">Layout instruction 之 argument 和 action</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-15 09:42:56" itemprop="dateCreated datePublished" datetime="2017-09-15T09:42:56+08:00">2017-09-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本篇我们将通过一个 demo 来演示如何使用 layout 指令 ——— argument 和 action 。 本篇基于 <a target="_blank" rel="noopener" href="https://www.hellomagento2.com/%E5%88%9B%E5%BB%BA-magento-2-hello-world-simple-module/">创建 Magento 2 Hello World Simple Module</a> 文章中的简单模块。</p>
<h2 id="创建-Controller"><a href="#创建-Controller" class="headerlink" title="创建 Controller"></a><a href="#%E5%88%9B%E5%BB%BA-controller"></a>创建 Controller</h2><p>File:app\code\ThankIT\HelloWorld\Controller\Layout\Instruction.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Controller\Layout;</span><br><span class="line"></span><br><span class="line">class Instruction extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $resultPageFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor</span><br><span class="line">     *</span><br><span class="line">     * @param \Magento\Framework\App\Action\Context  $context</span><br><span class="line">     * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">     */</span><br><span class="line">    public function __construct(</span><br><span class="line">        \Magento\Framework\App\Action\Context $context,</span><br><span class="line">        \Magento\Framework\View\Result\PageFactory $resultPageFactory</span><br><span class="line">    ) &#123;</span><br><span class="line">        $this-&gt;resultPageFactory = $resultPageFactory;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute view action</span><br><span class="line">     *</span><br><span class="line">     * @return \Magento\Framework\Controller\ResultInterface</span><br><span class="line">     */</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;resultPageFactory-&gt;create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建-layout"><a href="#创建-layout" class="headerlink" title="创建 layout"></a><a href="#%E5%88%9B%E5%BB%BA-layout"></a>创建 layout</h2><p>File:app\code\ThankIT\HelloWorld\view\frontend\layout\helloworld_layout_instruction.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;page layout=&quot;1column&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;referenceContainer name=&quot;content&quot;&gt;</span><br><span class="line">            &lt;block class=&quot;ThankIT\HelloWorld\Block\Layout\Instruction&quot; name=&quot;layout.instruction&quot; template=&quot;ThankIT_HelloWorld::layout/instruction.phtml&quot;&gt;</span><br><span class="line">                &lt;arguments&gt;</span><br><span class="line">                    &lt;argument name=&quot;label&quot; xsi:type=&quot;string&quot;&gt;Block Label&lt;/argument&gt;</span><br><span class="line">                &lt;/arguments&gt;</span><br><span class="line">                &lt;action method=&quot;doSomething&quot;&gt;</span><br><span class="line">                    &lt;argument translate=&quot;true&quot; name=&quot;thing&quot; xsi:type=&quot;string&quot;&gt;Running&lt;/argument&gt;</span><br><span class="line">                &lt;/action&gt;</span><br><span class="line">            &lt;/block&gt;</span><br><span class="line">        &lt;/referenceContainer&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<h2 id="创建-Block"><a href="#创建-Block" class="headerlink" title="创建 Block"></a><a href="#%E5%88%9B%E5%BB%BA-block"></a>创建 Block</h2><p>File:app\code\ThankIT\HelloWorld\Block\Layout\Instruction.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Block\Layout;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\View\Element\Template;</span><br><span class="line"></span><br><span class="line">class Instruction extends Template</span><br><span class="line">&#123;</span><br><span class="line">    public function doSomething($thing)</span><br><span class="line">    &#123;</span><br><span class="line">        // do something ...</span><br><span class="line">        $this-&gt;setData(&#x27;some_thing&#x27;, $thing);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建-view"><a href="#创建-view" class="headerlink" title="创建 view"></a><a href="#%E5%88%9B%E5%BB%BA-view"></a>创建 view</h2><p>File:app\code\ThankIT\HelloWorld\view\frontend\templates\layout\instruction.phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo $block-&gt;getLabel();?&gt;</span><br><span class="line">&lt;?php //等价于//echo $block-&gt;getData(&#x27;label&#x27;);?&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;?php echo $block-&gt;getSomeThing();?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a><a href="#%E6%B5%8B%E8%AF%95"></a>测试</h2><p>刷新缓存后，访问 <code>http://example/helloworld/layout/instruction/</code> 会看到： <img src="/wp-content/uploads/2017/09/layout-instruction-argument-action.png" alt="layout-instruction-argument-action"></p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"></a>注意点</h2><h3 id="Use-block-object-methods-to-set-block-properties"><a href="#Use-block-object-methods-to-set-block-properties" class="headerlink" title="Use block object methods to set block properties"></a><a href="#use-block-object-methods-to-set-block-properties"></a>Use block object methods to set block properties</h3><p>There are two ways to access block object methods:</p>
<ul>
<li>using the <code>&lt;argument&gt;</code> instruction for <code>&lt;block&gt;</code> or <code>&lt;referenceBlock&gt;</code></li>
<li>using the <code>&lt;action&gt;</code> instruction. This way is not recommended, but can be used for calling those methods, which are not refactored yet to be accessed through <code>&lt;argument&gt;</code>.</li>
</ul>
<p><em>Do not use <code>&lt;action&gt;</code>, if the method implementation allows calling it using <code>&lt;argument&gt;</code> for <code>&lt;block&gt;</code> or <code>&lt;referenceBlock&gt;</code>.</em></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.0/frontend-dev-guide/layouts/xml-manage.html">Common layout customization tasks</a> <a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.0/frontend-dev-guide/layouts/xml-instructions.html#argument">Layout instructions</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/magento-2-create-admin-menu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/magento-2-create-admin-menu/" class="post-title-link" itemprop="url">Magento 2 Create Admin Menu</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-13 10:12:06" itemprop="dateCreated datePublished" datetime="2017-09-13T10:12:06+08:00">2017-09-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本篇我们将介绍如何创建 Admin menu 。 Admin menu 看起来就是这样： <img src="/wp-content/uploads/2017/09/admin-menu.png" alt="admin menu"> 他是有层次的。可以分成三级，最左侧大类的 Sales ，然后是分组 Operation ，然后是 Orders 和 invoice 等。 我们来看 orders 的链接结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example/admin/sales/order/index/key/9118b14253fc71837e2b0d7ea73c818b63d1401ebd1f04f310486d985f3e6d57/</span><br></pre></td></tr></table></figure>

<p>和前台的 url 结构相比较，他多出了 <code>admin</code> 和后面的 <code>/key/118b14253fc71837e2b0d7ea73c818b63d1401ebd1f04f310486d985f3e6d57/</code> key 是为了防止跨站脚本攻击（cross site script attacks） 后台的 url 结构就是(看到的)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/front-name/controller-name/action</span><br></pre></td></tr></table></figure>

<p>如果引用则是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/front-id/controller-name/action</span><br></pre></td></tr></table></figure>

<h2 id="创建-menu-xml"><a href="#创建-menu-xml" class="headerlink" title="创建 menu.xml"></a><a href="#%E5%88%9B%E5%BB%BA-menu.xml"></a>创建 menu.xml</h2><p>File:app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;etc&#x2F;adminhtml&#x2F;menu.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:module:Magento_Backend:etc/menu.xsd&quot;&gt;</span><br><span class="line">    &lt;menu&gt;</span><br><span class="line">       &lt;add id=&quot;ThankIT_HelloWorld::helloworld&quot; title=&quot;Hello World&quot; module=&quot;ThankIT_HelloWorld&quot; sortOrder=&quot;51&quot; resource=&quot;ThankIT_HelloWorld::helloworld&quot;/&gt;</span><br><span class="line">       &lt;add id=&quot;ThankIT_HelloWorld::post&quot; title=&quot;Posts&quot; module=&quot;ThankIT_HelloWorld&quot; sortOrder=&quot;10&quot; action=&quot;thankit_helloworld/post/index&quot; resource=&quot;ThankIT_HelloWorld::post&quot; parent=&quot;ThankIT_HelloWorld::helloworld&quot;/&gt;</span><br><span class="line">       &lt;add id=&quot;ThankIT_HelloWorld::helloworld_configuration&quot; title=&quot;Configuration&quot; module=&quot;ThankIT_HelloWorld&quot; sortOrder=&quot;99&quot; parent=&quot;ThankIT_HelloWorld::helloworld&quot; action=&quot;adminhtml/system_config/edit/section/helloworld&quot; resource=&quot;ThankIT_HelloWorld::helloworld_configuration&quot;/&gt;</span><br><span class="line">    &lt;/menu&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>注意 <code>action=&quot;adminhtml/system_config/edit/section/helloworld&quot;</code> 此处使用的是 <code>adminhtml</code> 而不是 <code>admin</code> 尽管我们看到的是 <code>admin</code> 。</p>
<ul>
<li>The id attribute is the identifier for this note. It’s a unique string and should follow the format: {Vendor_ModuleName}::{menu_description}.</li>
<li>The title attribute is the text which will be shown on the menu bar.</li>
<li>The module attribute is defined the module which this menu is belong to.</li>
<li>The sortOrder attribute is defined the position of the menu. Lower value will display on top of menu.</li>
<li>The parent attribute is an Id of other menu node. It will tell Magento that this menu is a child of another menu. In this example, we have parent&#x3D;”ThankIT_HelloWorld::helloworld”, so we - know this menu “Posts” is a child of “Hello World” menu and it will show inside of Hello World menu.</li>
<li>The action attribute will define the url of the page which this menu link to. As we talk above, the url will be followed this format {router_name}{controller_folder}{action_name}.</li>
<li>The resource attribute is used to defined the ACL rule which the admin user must have in order to see and access this menu. We will find more detail about ACL in other topic.</li>
</ul>
<p>关于最左侧的大类的 icon 请参考<a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.1/pattern-library/graphics/iconography/iconography.html">Magento Admin Pattern Library-Iconography</a> 效果如下 <img src="/wp-content/uploads/2017/09/menu-%E6%95%88%E6%9E%9C.png" alt="menu效果"> 这里只有两层结构，下面看下三层的结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">/**</span><br><span class="line"> * Copyright © 2013-2017 Magento, Inc. All rights reserved.</span><br><span class="line"> * See COPYING.txt for license details.</span><br><span class="line"> */</span><br><span class="line">--&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:module:Magento_Backend:etc/menu.xsd&quot;&gt;</span><br><span class="line">    &lt;menu&gt;</span><br><span class="line">        &lt;add id=&quot;Magento_Sales::sales&quot; title=&quot;Sales&quot; translate=&quot;title&quot; module=&quot;Magento_Sales&quot; sortOrder=&quot;15&quot; dependsOnModule=&quot;Magento_Sales&quot; resource=&quot;Magento_Sales::sales&quot;/&gt;</span><br><span class="line">        &lt;add id=&quot;Magento_Sales::sales_operation&quot; title=&quot;Operations&quot; translate=&quot;title&quot; module=&quot;Magento_Sales&quot; sortOrder=&quot;10&quot; parent=&quot;Magento_Sales::sales&quot; resource=&quot;Magento_Sales::sales_operation&quot; /&gt;</span><br><span class="line">        &lt;add id=&quot;Magento_Sales::sales_order&quot; title=&quot;Orders&quot; translate=&quot;title&quot; module=&quot;Magento_Sales&quot; sortOrder=&quot;10&quot; parent=&quot;Magento_Sales::sales_operation&quot; action=&quot;sales/order&quot; resource=&quot;Magento_Sales::sales_order&quot;/&gt;</span><br><span class="line">        &lt;add id=&quot;Magento_Sales::sales_invoice&quot; title=&quot;Invoices&quot; translate=&quot;title&quot; module=&quot;Magento_Sales&quot; sortOrder=&quot;20&quot; parent=&quot;Magento_Sales::sales_operation&quot; action=&quot;sales/invoice&quot; resource=&quot;Magento_Sales::sales_invoice&quot;/&gt;</span><br><span class="line">        ....</span><br><span class="line">    &lt;/menu&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>对应第一张的图片。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/create-admin-menu-magento-2.html">Magento 2 Create Admin Menu</a><br><a target="_blank" rel="noopener" href="http://alanstorm.com/magento_2_admin_menu_items/">Magento 2: Admin Menu Items</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/magento-2-admin-acl-access-control-lists/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/magento-2-admin-acl-access-control-lists/" class="post-title-link" itemprop="url">Magento 2 Admin ACL Access Control Lists</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-11 08:13:02" itemprop="dateCreated datePublished" datetime="2017-09-11T08:13:02+08:00">2017-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Magento 2 Admin ACL 用来创建访问权限列表（Access Controller List Rules）。管理员可以创建不同的角色，给角色分配权限，给后台用户赋予角色，从而控制后台用户的访问权限。本文将介绍 ACL 是如何工作的以及如何给自己的模块添加 ACL。 acl.xml is used for backend actions protection and web Api. 后台访问 <code>System &gt; Permissions &gt; User Roles</code> 我们点击 <strong>Add New Role</strong> 或者点击某个角色，就会看到类似下图的界面： <img src="/wp-content/uploads/2017/09/role-resources.png" alt="Role Resources"> 对于某个后台用户来讲，他只能访问他的角色所拥有的 resources ，没有的看都看不到。</p>
<h2 id="创建-ACL-rule"><a href="#创建-ACL-rule" class="headerlink" title="创建 ACL rule"></a><a href="#%E5%88%9B%E5%BB%BA-acl-rule"></a>创建 ACL rule</h2><p>以之前的 <code>ThankIT_HelloWorld</code> 模块为基础。 File:app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;etc&#x2F;acl.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Acl/etc/acl.xsd&quot;&gt;</span><br><span class="line">     &lt;acl&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource id=&quot;Magento_Backend::admin&quot;&gt;</span><br><span class="line">                &lt;resource id=&quot;ThankIT_HelloWorld::helloworld&quot; title=&quot;Hello World&quot; sortOrder=&quot;51&quot;&gt;</span><br><span class="line">                    &lt;resource id=&quot;ThankIT_HelloWorld::post&quot; title=&quot;Posts&quot; sortOrder=&quot;10&quot;/&gt;</span><br><span class="line">                    &lt;resource id=&quot;ThankIT_HelloWorld::helloworld_configuration&quot; title=&quot;Configuration&quot; sortOrder=&quot;99&quot; /&gt;</span><br><span class="line">                &lt;/resource&gt;</span><br><span class="line">                &lt;resource id=&quot;Magento_Backend::stores&quot;&gt;</span><br><span class="line">                    &lt;resource id=&quot;Magento_Backend::stores_settings&quot;&gt;</span><br><span class="line">                        &lt;resource id=&quot;Magento_Config::config&quot;&gt;</span><br><span class="line">                            &lt;resource id=&quot;ThankIT_HelloWorld::hello_configuration&quot; title=&quot;Hello World&quot;/&gt;</span><br><span class="line">                        &lt;/resource&gt;</span><br><span class="line">                    &lt;/resource&gt;</span><br><span class="line">                &lt;/resource&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">    &lt;/acl&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>Our resource will be placed as child of Magento_Backend::admin. Each resource will have an Id, title and sortOrder attribute:</p>
<ul>
<li>Id attribute is the identify of this resource. You can use this when define resource in Admin menu, configuration and limit access to your module controller. This is a unique string and should be in this format: Vendor_ModuleName::resource_name.</li>
<li>Title attribute is the label of this resource when showing in resource tree.</li>
<li>sortOrder attribute define the position of this resource in tree.</li>
</ul>
<p>刷新缓存，我们可以看到原来的 ACL 添加了一些东西： <img src="/wp-content/uploads/2017/09/acl-helloworld.png" alt="acl"></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a><a href="#%E9%AA%8C%E8%AF%81"></a>验证</h2><p>之前文章中我们的 <code>system.xml</code> 中有相关的 resource 引用： File：app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;etc&#x2F;adminhtml&#x2F;system.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;section id=&quot;helloworld&quot; translate=&quot;label&quot; sortOrder=&quot;130&quot; showInDefault=&quot;1&quot; showInWebsite=&quot;1&quot; showInStore=&quot;1&quot;&gt;</span><br><span class="line">        ….</span><br><span class="line">            &lt;resource&gt;ThankIT_HelloWorld::hello_configuration&lt;/resource&gt;</span><br><span class="line">        ….</span><br><span class="line">&lt;/section&gt;</span><br></pre></td></tr></table></figure>

<p>我们新建一个 test 后台用户，一个 test 角色，角色权限仅勾选上图中的 stores 下的 Hello Wolrd （第二个，不是第一个）。然后我们以 test 用户登录，发现我们可以访问 configuration 中 Hello World Section ，如果不够选的话，看也看不到。</p>
<h3 id="Admin-Controller-中检查权限"><a href="#Admin-Controller-中检查权限" class="headerlink" title="Admin Controller 中检查权限"></a><a href="#admin-controller-%E4%B8%AD%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90"></a>Admin Controller 中检查权限</h3><p>Admin Controller 中通过覆写 <code>_isAllowed()</code> 来检查权限。 比如 File: vendor&#x2F;magento&#x2F;module-customer&#x2F;Controller&#x2F;Adminhtml&#x2F;Index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected function _isAllowed()</span><br><span class="line">&#123;</span><br><span class="line"> return $this-&gt;_authorization-&gt;isAllowed(&#x27;Magento_Customer::manage&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为 Admin Controller 继承自 <code>\Magento\Backend\App\Action</code> 它又继承自 <code>\Magento\Backend\App\AbstractAction</code> 这样可以追查到 <code>$this-&gt;_authorization</code> 是 <code>Magento\Framework\AuthorizationInterface</code> File:Magento\Backend\App\AbstractAction.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const ADMIN_RESOURCE = &#x27;Magento_Backend::admin&#x27;;</span><br><span class="line">    /**</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    protected function _isAllowed()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;_authorization-&gt;isAllowed(static::ADMIN_RESOURCE);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="static"><a href="#static" class="headerlink" title="static"></a><a href="#static"></a>static</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">    const ADMIN_RESOURCE = &#x27;Magento_Backend::admin&#x27;;</span><br><span class="line">    public function getResource()</span><br><span class="line">    &#123;</span><br><span class="line">        echo static::ADMIN_RESOURCE;</span><br><span class="line">        echo self::ADMIN_RESOURCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B extends A</span><br><span class="line">&#123;</span><br><span class="line">    const ADMIN_RESOURCE = &#x27;B&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$b = new B();</span><br><span class="line">$b-&gt;getResource();</span><br><span class="line"></span><br><span class="line">// 输出 B</span><br><span class="line">// 输出 Magento_Backend::admin</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/magento-2-acl-access-control-lists.html">Magento 2 Admin ACL Access Control Lists</a> <a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/93840/how-does-magento2-access-control-list-work">How does Magento2 Access Control List work?</a> <a target="_blank" rel="noopener" href="http://alanstorm.com/magento_2_understanding_access_control_list_rules/">Magento 2: Understanding Access Control List Rules</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/system-xml-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/system-xml-configuration/" class="post-title-link" itemprop="url">System.xml Configuration</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-09 16:22:11" itemprop="dateCreated datePublished" datetime="2017-09-09T16:22:11+08:00">2017-09-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">插件开发系列教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如果模块需要管理员设置某些选项，就需要通过 <code>system.xml</code> 配置文件来创建和保存配置字段。那么我们怎么创建和使用 <code>system.xml</code> 呢？</p>
<h2 id="第一步：创建-system-xml"><a href="#第一步：创建-system-xml" class="headerlink" title="第一步：创建 system.xml"></a><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA-system.xml"></a>第一步：创建 system.xml</h2><p>请在 Magento 2 后台进入 <code>Stores -&gt; Settings -&gt; Configuration</code> 。 Magento 2 的系统配置页面被分成了几个部分：Tabs, Sections, Groups, Fields 。 <img src="/wp-content/uploads/2017/09/tabs-sections-groups-fields.png" alt="Magento 2 system configuration page is divided logically in few parts: Tabs, Sections, Groups, Fields"> 以之前的 <code>ThankIT_HelloWorld</code> 模块为基础，下面我们创建一个配置页面，tab 是 ThankIT （for our vendor），section 是 Hello World （for our module），group 组包含一些简单的字段。 File: app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;etc&#x2F;adminhtml&#x2F;system.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:module:Magento_Config:etc/system_file.xsd&quot;&gt;</span><br><span class="line">    &lt;system&gt;</span><br><span class="line">        &lt;tab id=&quot;mageplaza&quot; translate=&quot;label&quot; sortOrder=&quot;10&quot;&gt;</span><br><span class="line">            &lt;label&gt;Mageplaza&lt;/label&gt;</span><br><span class="line">        &lt;/tab&gt;</span><br><span class="line">        &lt;section id=&quot;helloworld&quot; translate=&quot;label&quot; sortOrder=&quot;130&quot; showInDefault=&quot;1&quot; showInWebsite=&quot;1&quot; showInStore=&quot;1&quot;&gt;</span><br><span class="line">            &lt;class&gt;separator-top&lt;/class&gt;</span><br><span class="line">            &lt;label&gt;Hello World&lt;/label&gt;</span><br><span class="line">            &lt;tab&gt;mageplaza&lt;/tab&gt;</span><br><span class="line">            &lt;resource&gt;Mageplaza_HelloWorld::hello_configuration&lt;/resource&gt;</span><br><span class="line">            &lt;group id=&quot;general&quot; translate=&quot;label&quot; type=&quot;text&quot; sortOrder=&quot;10&quot; showInDefault=&quot;1&quot; showInWebsite=&quot;0&quot; showInStore=&quot;0&quot;&gt;</span><br><span class="line">                &lt;label&gt;General Configuration&lt;/label&gt;</span><br><span class="line">                &lt;field id=&quot;enable&quot; translate=&quot;label&quot; type=&quot;select&quot; sortOrder=&quot;1&quot; showInDefault=&quot;1&quot; showInWebsite=&quot;0&quot; showInStore=&quot;0&quot;&gt;</span><br><span class="line">                    &lt;label&gt;Module Enable&lt;/label&gt;</span><br><span class="line">                    &lt;source_model&gt;Magento\Config\Model\Config\Source\Yesno&lt;/source_model&gt;</span><br><span class="line">                &lt;/field&gt;</span><br><span class="line">                &lt;field id=&quot;display_text&quot; translate=&quot;label&quot; type=&quot;text&quot; sortOrder=&quot;1&quot; showInDefault=&quot;1&quot; showInWebsite=&quot;0&quot; showInStore=&quot;0&quot;&gt;</span><br><span class="line">                    &lt;label&gt;Display Text&lt;/label&gt;</span><br><span class="line">                    &lt;comment&gt;This text will display on the frontend.&lt;/comment&gt;</span><br><span class="line">                &lt;/field&gt;</span><br><span class="line">            &lt;/group&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">    &lt;/system&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>以下是关于 system.xml 中一些元素的介绍。</p>
<ul>
<li>The Tab element may have many sections and some main attributes and child:<ul>
<li>Id attribute is the identify for this tab</li>
<li>sortOrder attribute will define the position of this tab.</li>
<li>Translate attribute let Magento know which title need to translate</li>
<li>Label element child is the text which will show as tab title.</li>
</ul>
</li>
<li>The Section element will have id, sortOrder, translate attributes like the Tab element. Some other attributes (showInDefault, showInWebsite, showInStore) will decide this element will be show on each scope or not. You can change the scope here <img src="/wp-content/uploads/2017/09/configuration-scope.png" alt="change system configuration scope"></li>
</ul>
<p>The section may have many group and some other child elements:</p>
<ul>
<li>Class: this value will be added as class for this element. You should use it if you want to make-up this element.</li>
<li>Label: the text title of this element</li>
<li>Tab: this’s a tab id. This tab element will let Magento know the tab which this section is belong to. This section will be placed under that tab</li>
<li>Resource: defined the ACL rule which the admin user must have in order to access this configuration.</li>
<li>Group: This element may have many field and some attributes which is same as Sections.</li>
<li>Fields: is the main path of this page. It will save the data which we want to setting. In this element, we focus on the type attribute. It will define how the element is when display. It can be: text, select, file… In this example we create 2 fields with type select and text. With each type we will define the child element for the field to make it work as we want.</li>
</ul>
<h2 id="第二步：设置默认值"><a href="#第二步：设置默认值" class="headerlink" title="第二步：设置默认值"></a><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC"></a>第二步：设置默认值</h2><p>我么可以通过 <code>config.xml</code> 来给 <code>system.xml</code> 中的字段设置默认值。 File: app&#x2F;code&#x2F;ThankIT&#x2F;HelloWorld&#x2F;etc&#x2F;config.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:module:Magento_Store:etc/config.xsd&quot;&gt;</span><br><span class="line">    &lt;default&gt;</span><br><span class="line">        &lt;helloworld&gt;</span><br><span class="line">            &lt;general&gt;</span><br><span class="line">                &lt;enable&gt;1&lt;/enable&gt;</span><br><span class="line">                &lt;display_text&gt;Hello World&lt;/display_text&gt;</span><br><span class="line">            &lt;/general&gt;</span><br><span class="line">        &lt;/helloworld&gt;</span><br><span class="line">    &lt;/default&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;default&gt;</span><br><span class="line">    &lt;section_id&gt;</span><br><span class="line">        &lt;group_id&gt;</span><br><span class="line">            &lt;field_id&gt;&#123;value&#125;&lt;/field_id&gt;</span><br><span class="line">        &lt;/group_id&gt;</span><br><span class="line">    &lt;/section_id&gt;</span><br><span class="line">&lt;/default&gt;</span><br></pre></td></tr></table></figure>

<h2 id="第三步：刷新缓存"><a href="#第三步：刷新缓存" class="headerlink" title="第三步：刷新缓存"></a><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%88%B7%E6%96%B0%E7%BC%93%E5%AD%98"></a>第三步：刷新缓存</h2><p>刷新缓存后，你就可以看到结果了： <img src="/wp-content/uploads/2017/09/thankit_helloworld_configuration_page.png" alt="ThankIT HelloWorld Configuration page"></p>
<h2 id="第四步：获得配置值"><a href="#第四步：获得配置值" class="headerlink" title="第四步：获得配置值"></a><a href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E8%8E%B7%E5%BE%97%E9%85%8D%E7%BD%AE%E5%80%BC"></a>第四步：获得配置值</h2><p>在 <code>system.xml</code> 中，我们加了两个字段，他们的 path 是： <code>helloworld/general/enable</code> <code>helloworld/general/display_text</code> 然后，我们改一下配置，保存后，刷新缓存。我们查看 <code>core_config_data</code> 这张数据库表，就会看到我们保存的配置值了（只创建了 config.xml 并不会在该表插入记录，后台点击保存后才会在表中插入记录）。 <img src="/wp-content/uploads/2017/09/core_config_data_records.png" alt="core_config_data 中的记录值"> 万变不离其宗，获取配置值，是通过 <code>\Magento\Framework\App\Config\ScopeConfigInterface</code> 来实现的。 通过查 di.xml 可以发现 <code>&lt;preference for=&quot;Magento\Framework\App\Config\ScopeConfigInterface&quot; type=&quot;Magento\Framework\App\Config&quot; /&gt;</code> 所以实际注入的是 <code>Magento\Framework\App\Config</code></p>
<h3 id="标准用法"><a href="#标准用法" class="headerlink" title="标准用法"></a><a href="#%E6%A0%87%E5%87%86%E7%94%A8%E6%B3%95"></a>标准用法</h3><p>在构造函数中注入 <code>\Magento\Framework\App\Config\ScopeConfigInterface $scopeConfig</code> 并设置 <code>$this-&gt;scopeConfig = $scopeConfig;</code> 我们就可以通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;scopeConfig-&gt;getValue(&#x27;helloworld/general/enable&#x27;, \Magento\Store\Model\ScopeInterface::SCOPE_STORE);</span><br></pre></td></tr></table></figure>

<p>来取得 <code>helloworld/general/enable</code> 的设置值。</p>
<h3 id="通过-helper-来取得配置值"><a href="#通过-helper-来取得配置值" class="headerlink" title="通过 helper 来取得配置值"></a><a href="#%E9%80%9A%E8%BF%87-helper-%E6%9D%A5%E5%8F%96%E5%BE%97%E9%85%8D%E7%BD%AE%E5%80%BC"></a>通过 helper 来取得配置值</h3><p>File: ThankIT&#x2F;HelloWorld&#x2F;Helper&#x2F;Data.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace ThankIT\HelloWorld\Helper;</span><br><span class="line"></span><br><span class="line">use Magento\Framework\App\Helper\AbstractHelper;</span><br><span class="line">use Magento\Framework\App\Helper\Context;</span><br><span class="line">use Magento\Store\Model\ScopeInterface;</span><br><span class="line"></span><br><span class="line">class Data extends AbstractHelper</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    const XML_PATH_HELLOWORLD = &#x27;helloworld/general/&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct(Context $context)</span><br><span class="line">    &#123;</span><br><span class="line">        parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getConfigValue($field, $storeId = null)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;scopeConfig-&gt;getValue(</span><br><span class="line">            $field, ScopeInterface::SCOPE_STORE, $storeId</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getGeneralConfig($code, $storeId = null)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;getConfigValue(self::XML_PATH_HELLOWORLD . $code, $storeId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File: app\code\ThankIT\HelloWorld\view\frontend\templates\index\index.phtml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;h3&gt;get configuration value by helper file&lt;/h3&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$helper = $this-&gt;helper(&#x27;ThankIT\HelloWorld\Helper\Data&#x27;);</span><br><span class="line">echo $helper-&gt;getConfigValue(&#x27;helloworld/general/display_text&#x27;);</span><br><span class="line">echo &#x27;&lt;br/&gt;&#x27;;</span><br><span class="line">echo $helper-&gt;getGeneralConfig(&#x27;display_text&#x27;);</span><br></pre></td></tr></table></figure>

<p>结果： <img src="/wp-content/uploads/2017/09/get-configuration-value-by-helper-file.png" alt="get-configuration-value-by-helper-file"> _ 关于 helper Helpers are classes that can be used anywhere we want,we can use them in controllers,views,modeles and even in other helpers. Helpers are usually created to provide methods for a common functionality. 它一般位于 &#x2F;Helper 目录下，常用的文件名是 Data.php 它继承自 <code>Magento\Framework\App\Helper\AbstractHelper</code> _ 因为他的父类已经注入了<code>\Magento\Framework\App\Config\ScopeConfigInterface</code> 所以我们可以在 helper 中使用 <code>$this-&gt;scopeConfig-&gt;getValue()</code> 来获得配置值。 在 block 中我们可以通过 <code>$this-&gt;helper(&#39;&#123;Vendor&#125;\&#123;Module&#125;\Helper\Data&#39;);</code> 来获得 helper 。注意，此处一定是右斜杠。path 是左斜杠。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.mageplaza.com/magento-2-module-development/create-system-xml-configuration-magento-2.html">Magento 2 How to Create System.xml Configuration</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">313</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">136</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
